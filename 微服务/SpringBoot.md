# SpringBoot

>  å­¦ä¹ æµç¨‹

![1588145129189](SpringBoot.assets/1588145129189.png)

> ä»€ä¹ˆäº‹SpringBoot

SpringBootåŸºäºSpringå¼€å‘ï¼Œå¹¶ä¸æ˜¯æ›¿ä»£Springï¼Œè€Œæ˜¯å’ŒSpringç´§å¯†ç»“åˆç”¨äºæå‡Springä½“éªŒã€‚

SpringBoot **çº¦å®šå¤§äºé…ç½®**ï¼Œé»˜è®¤è¿›è¡Œäº†å¾ˆå¤šé…ç½®ï¼Œåªéœ€è¦å¾ˆå°‘çš„é…ç½®å°±å¯ä»¥å¼€å‘ã€‚

> ä¼˜ç‚¹

- Springå¼€å‘æ›´åŠ å…¥é—¨
- å¼€ç®±å³ç”¨ï¼Œç®€åŒ–é…ç½®
- å†…åµŒå®¹å™¨ç®€åŒ–Webé¡¹ç›®
- æ²¡æœ‰XMLé…ç½®å’Œå†—ä½™ä»£ç 



## å¾®æœåŠ¡

> ä»€ä¹ˆæ˜¯å¾®æœåŠ¡

 å¾®æœåŠ¡æ˜¯ä¸€ç§**æ¶æ„é£æ ¼**ã€‚ æ˜¯ä¸€ç§å°†ä¸€ä¸ªå•ä¸€åº”ç”¨ç¨‹åºå¼€å‘ä¸ºä¸€ç»„å°å‹æœåŠ¡çš„æ–¹æ³•ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡é—´é€šä¿¡é‡‡ç”¨è½»é‡çº§é€šä¿¡æœºåˆ¶(é€šå¸¸ç”¨HTTPèµ„æºAPI)ã€‚ 

ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æœåŠ¡ï¼Œå½»åº•å»æ‰è€¦åˆï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡æä¾›å•ä¸ªä¸šåŠ¡åŠŸèƒ½ï¼Œä¸€ä¸ªæœåŠ¡åªåšä¸€ä»¶äº‹ã€‚ å°æœåŠ¡ä¹‹é—´ç”¨httpæˆ–RPCæ–¹å¼äº’é€š

> å•ä½“åº”ç”¨æ¡†æ¶

å°±æ˜¯SSMï¼Œå…¨éƒ¨æ”¾åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œæ‰“åŒ…ä¸ºä¸€ä¸ªwaråŒ…ã€‚

**å¥½å¤„**ï¼š

- æ˜“äºå¼€å‘å’Œæµ‹è¯•ï¼Œéƒ¨ç½²ååˆ†æ–¹ä¾¿ã€‚éœ€è¦æ‹“å±•æ—¶ï¼Œå¯ä»¥å¤åˆ¶å¤šä¸ªwaråŒ…åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œåšä¸ªè´Ÿè½½å‡è¡¡

**åå¤„**ï¼š

- æˆ‘è¦ä¿®æ”¹ä¸€ä¸ªå°å°çš„åœ°æ–¹ä¹Ÿè¦åœæ‰æ‰€æœ‰æœåŠ¡ï¼Œé‡æ–°æ‰“åŒ…æˆä¸€ä¸ªwaråŒ…

> å¾®æœåŠ¡æ¶æ„

æŠŠåŠŸèƒ½ç‹¬ç«‹å‡ºæ¥ï¼Œä¸šåŠ¡ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½ç»„æˆã€‚ä¸»è¦å¤šä¸ªä¸šåŠ¡å°±èµ‹å€¼å¤šä¸ªåŠŸèƒ½è€Œä¸æ˜¯waråŒ…

**å¥½å¤„**ï¼š

- èŠ‚çœäº†èµ„æºï¼Œå‡å°‘ä»£ç å†—ä½™
- æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¾¿äºç»´æŠ¤

ä½†æ˜¯ï¼Œè¿™ç§åºå¤§çš„ç³»ç»Ÿæ¶æ„ç»™éƒ¨ç½²å’Œè¿ç»´å¸¦æ¥äº†å¾ˆå¤§éš¾åº¦ã€‚ï¼ŒSpringç»™äº†ä¸€å¥—å®Œæ•´çš„å¾®æœåŠ¡ï¼š

- æ„å»ºç‹¬ç«‹åŠŸèƒ½ç”¨**SpringBoot** å¿«é€Ÿæ„å»º
- å¤§å‹**åˆ†å¸ƒå¼ç½‘è·¯æœåŠ¡**çš„è°ƒç”¨ä½¿ç”¨**Spring cloud** æ¥å®ç°åˆ†å¸ƒå¼
- **ä¸­é—´ä»¶**æœ‰**spring cloud data flow**
- 

  http://blog.cuicc.com/blog/2015/07/22/microservices/# ![img](SpringBoot.assets/sketch.png)  

## ç¬¬ä¸€ä¸ªspringbooté¡¹ç›®

![1588213837946](SpringBoot.assets/1588213837946.png)

**é€‰æ‹©web**

![1588213859198](SpringBoot.assets/1588213859198.png)

**å®Œæˆï¼**

![1588213890998](SpringBoot.assets/1588213890998.png)



> å»ºåŒ…è¦åœ¨ä¸»ç¨‹åºçš„åŒçº§ç›®å½•ä¸‹

![1588213967068](SpringBoot.assets/1588213967068.png)

> controller

```java
@RestController
public class Contreoller {

    @RequestMapping("/YY")
    public String data(){

        return "YY";
    }
}
```

> è¿è¡Œæ•ˆæœ

![1588214765411](SpringBoot.assets/1588214765411.png)

> æ›´æ”¹é¡¹ç›®ç«¯å£å·

![](SpringBoot.assets/QQå›¾ç‰‡20200430110530.png)

> banner

èµ„æºç›®å½•ä¸‹åˆ›å»ºbanner.txt



## æ‰“åŒ…

> package

![1588214808366](SpringBoot.assets/1588214808366.png)

> ä½ç½®

åœ¨targetç›®å½•ä¸‹

![1588214848702](SpringBoot.assets/1588214848702.png)

> powershell

åœ¨jarçš„ç›®å½•ä¸‹ï¼Œ**æŒ‰ä½shiftå’Œå³é”®**ï¼Œæ‰“å¼€powershellçª—å£

è¾“å…¥java -jar .\é¡¹ç›®å

![1588215197111](SpringBoot.assets/1588215197111.png)

æœåŠ¡å¯åŠ¨äº†,å…³é—­ideaçš„tomcatï¼Œå†æ¬¡æ‰“å¼€ http://localhost:8080/YY ï¼Œè¿˜æ˜¯èƒ½è®¿é—®ï¼

å…³é—­powershellçª—å£åå°±æ— æ³•è®¿é—®äº†

> å¾®æœåŠ¡

è¿™å°±æ˜¯å¾®æœåŠ¡ï¼ŒæŠŠæœåŠ¡å˜æˆä¸€ä¸ªä¸ªå—ï¼Œä¸ä¾èµ–ideaä¹Ÿèƒ½æ‰“å¼€ï¼Œå†…ç½®äº†tomcat



# 

# 1.è‡ªåŠ¨è£…é…

## ä¾èµ–

#### pom.xml

pom.xmlçš„**çˆ¶ç±»** spring-boot-starter-parent



> å¯åŠ¨å™¨
>
> > spring-boot-starter-XXX:ä»dependenciesä¸­è‡ªåŠ¨å¯¼å…¥ç¯å¢ƒä¾èµ–

**ä¾‹å¦‚**-webï¼š**è‡ªåŠ¨å¯¼å…¥webç¯å¢ƒçš„æ‰€æœ‰ä¾èµ–**

ç‚¹å‡»å»å°±èƒ½å‘ç°**å¾ˆå¤šä¾èµ–åŒ…**ï¼šspring-webï¼Œspring-webmvcï¼Œtomcatï¼Œjson

```xml
 <dependency>
<!--          å¯åŠ¨å™¨ï¼Œwebè¿™ä¸ªä¾èµ–åŒ…å«äº†SpringMvc,è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨tomcatä¸ºé»˜è®¤å®¹å™¨-->
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
```





####  spring-boot-starter-parent

>  èµ„æºè¿‡æ»¤,mavenæ’ä»¶

```
<resources>
      <resource>
        <filtering>true</filtering>
        <directory>${basedir}/src/main/resources</directory>
        <includes>
          <include>**/application*.yml</include>
          <include>**/application*.yaml</include>
          <include>**/application*.properties</include>
        </includes>
      </resource>
      <resource>
        <directory>${basedir}/src/main/resources</directory>
        <excludes>
          <exclude>**/application*.yml</exclude>
          <exclude>**/application*.yaml</exclude>
          <exclude>**/application*.properties</exclude>
        </excludes>
      </resource>
    </resources>
```

#### dependenices

>æ‰€æœ‰åŠŸèƒ½åœºæ™¯å˜æˆå¯åŠ¨å™¨

spring-boot-dependencies åŒ…ä¸‹ï¼Œå·²ç»æŒ‡å®šå¥½äº†é‚£ä¸ªç‰ˆæœ¬ï¼Œä¾èµ–æ—¶å°±ä¸éœ€è¦æŒ‡å®šäº†

![1588217280640](SpringBoot.assets/1588217280640.png)

è¿™äº›å°±æ˜¯**å¯åŠ¨å™¨**

å¦‚æœä½ æƒ³ç”¨å“ªä¸ªç¯å¢ƒï¼Œå°±å¯ç”¨å¯¹åº”çš„å¯åŠ¨å™¨å°±è¡Œäº†

> è‡ªå¸¦ä¾èµ–

![1588314202626](SpringBoot.assets/1588314202626.png)

pom.xmlçš„webåŒ…å°±æ˜¯ä»dependenciesä¸­å–å‡ºæ¥



## ä¸»ç¨‹åº

```java
//è¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªComponent
@SpringBootApplication
//@SpringBootApplicationæ ‡å¿—è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªspringbootçš„åº”ç”¨
public class DemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

}
```



### æ³¨è§£



#### @ä¸»é…ç½®ç±»ï¼šspringBootApplicationï¼š

==ä½œç”¨==ï¼šå°†è¯¥åŒ…åŠå…¶æ‰€æœ‰å­åŒ…çº³å…¥springå®¹å™¨,**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦å°†ä¸šåŠ¡æ”¾åˆ°ä¸»ç¨‹åºåŒçº§ç›®å½•ä¸‹çš„åŸå› **

```java
//å…ƒæ³¨è§£ï¼Œç”¨æ¥ä¿®é¥°å½“å‰æ³¨è§£ï¼Œå°±åƒpublicç±»çš„ä¿®é¥°è¯ï¼Œæ— å®é™…åŠŸèƒ½
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
// springbootçš„é…ç½®ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ç±»ï¼Œå®ƒä¼šè¢«@ComponentScanæ‰«æåˆ°
@SpringBootConfiguration
// å¼€å¯è‡ªåŠ¨è£…é…
@EnableAutoConfiguration
//æ‰«æåŒ…ï¼ˆfiltersè¿‡æ»¤ä¸€äº›ä¸œè¥¿ï¼‰
@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })
public @interface SpringBootApplication {
```



##### @SpringBootConfigurationï¼šä¸»ç¨‹åºä¸ºé…ç½®ç±»

```
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
// é…ç½®ç±»
@Configuration
public @interface SpringBootConfiguration {
```







#### @EnableAutoConfiguration

==ä½œç”¨==ï¼šè‡ªåŠ¨æ³¨å†ŒåŒ…å’Œå¼•å…¥éœ€è¦çš„ç¬¬ä¸‰æ–¹jaråŒ…

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
//è·å–æ‰€åœ¨åŒ…è¿›è¡Œæ³¨å†Œ
@AutoConfigurationPackage
// å°†ç¬¬ä¸‰æ–¹jarå¼•å…¥
@Import(AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {
```



##### @AutoConfigurationPackageï¼šæ‰€åœ¨åŒ…æ³¨å†Œ

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
// å¯¹æºæ•°æ®æ‰€åœ¨åŒ…ä¸‹ç»„ä»¶è¿›è¡Œæ³¨å†Œ
@Import(AutoConfigurationPackages.Registrar.class)
public @interface AutoConfigurationPackage {
```



###### @AutoConfigurationPackages.Registrar

==ä½œç”¨==ï¼šæ‰“åŒ…æºæ•°æ®è·å–åŒ…åè°ƒç”¨registeræ³¨å†Œ

**register**æ–¹æ³•ï¼š æ³¨å†ŒåŒ…

```java
static class Registrar implements ImportBeanDefinitionRegistrar, DeterminableImports {

		@Override
		public void registerBeanDefinitions(AnnotationMetadata metadata, BeanDefinitionRegistry registry) {
            // 	new PackageImport(metadata).getPackageName())å°†æºæ•°æ®æ‰“åŒ…ï¼Œå¹¶è·å¾—å…¶åŒ…å
			register(registry, new PackageImport(metadata).getPackageName());
		}

		@Override
		public Set<Object> determineImports(AnnotationMetadata metadata) {
			return Collections.singleton(new PackageImport(metadata));
		}

	}
```

**åŒ…å**å°±æ˜¯è¿™ä¸ªï¼Œä¸»ç¨‹åºæ‰€åœ¨çš„åŒ…

![1588322355314](SpringBoot.assets/1588322355314.png)

##### @Importï¼šä¸‰æ–¹jaråŒ…

List<String> configurations = getCandidateConfigurations(annotationMetadata, attributes);

è¿›å…¥getCandidateConfigurations

> getCandidateConfigurations:

```java
protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {
    //  è¿™è¾¹è·å–æ‰€æœ‰é…ç½®  getSpringFactoriesLoaderFactoryClass()æ–¹æ³•å°±åœ¨ä¸‹é¢
		List<String> configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),
				getBeanClassLoader());
    //  å¦‚æœä¸ºç©ºï¼Œè¾“å‡ºè¯­å¥ï¼ŒMETA-INF/spring.factories
		Assert.notEmpty(configurations, "No auto configuration classes found in META-INF/spring.factories. If you "
				+ "are using a custom packaging, make sure that file is correct.");
		return configurations;
	}

//   EnableAutoConfigurationè¿”å›çš„å°±æ˜¯ä¸»ç¨‹åºçš„åŒ…ï¼Œæ‰€ä»¥è·å–çš„æ˜¯springbootçš„æ‰€æœ‰é…ç½®
	protected Class<?> getSpringFactoriesLoaderFactoryClass() {
		return EnableAutoConfiguration.class;
	}

```

###### loadFactoryNames

![](SpringBoot.assets/QQå›¾ç‰‡20200501175429.png)

> spring.factories

æ‰€åœ¨åœ°å€ï¼š

![1588255539786](SpringBoot.assets/1588255539786.png)

é‡Œé¢å‚¨å­˜çš„éƒ½æ˜¯é…ç½®ç±»çš„è·¯å¾„ï¼Œå½“ä½ éœ€è¦ç”¨æ—¶ï¼Œå°±ä¼šé€šè¿‡è·¯å¾„è°ƒç”¨é…ç½®ç±»ï¼ˆæ¯”å¦‚è§†å›¾è§£æå™¨ï¼‰

> 

#### å¯¼å›¾

![1588328045273](SpringBoot.assets/1588328045273.png)

---



### ä¸»å¯åŠ¨ç¨‹åº

#### springApplication

**è¿™ä¸ªç±»ä¸»è¦åšäº†ä»¥ä¸‹å››ä»¶äº‹æƒ…ï¼š**

1ã€æ¨æ–­åº”ç”¨çš„ç±»å‹æ˜¯æ™®é€šçš„é¡¹ç›®è¿˜æ˜¯Webé¡¹ç›®

2ã€æŸ¥æ‰¾å¹¶åŠ è½½æ‰€æœ‰å¯ç”¨åˆå§‹åŒ–å™¨ ï¼Œ è®¾ç½®åˆ°initializerså±æ€§ä¸­

3ã€æ‰¾å‡ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºç›‘å¬å™¨ï¼Œè®¾ç½®åˆ°listenerså±æ€§ä¸­

4ã€æ¨æ–­å¹¶è®¾ç½®mainæ–¹æ³•çš„å®šä¹‰ç±»ï¼Œæ‰¾åˆ°è¿è¡Œçš„ä¸»ç±»

æŸ¥çœ‹æ„é€ å™¨ï¼š

```java
public SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources) {
    
    //	 åŠ è½½èµ„æº
		this.resourceLoader = resourceLoader;
    //  primarySourceä¸èƒ½ä¸ºç©º
		Assert.notNull(primarySources, "PrimarySources must not be null");
    //  éå†primartSource
		this.primarySources = new LinkedHashSet<>(Arrays.asList(primarySources));
    //   æ¨æµ‹webåº”ç”¨ç±»å‹ï¼Œå¹¶èµ‹å€¼åˆ°å±æ€§webApplicationType
		this.webApplicationType = WebApplicationType.deduceFromClasspath();
    //   ç›‘å¬åˆå§‹åŒ–
		setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
		setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
		this.mainApplicationClass = deduceMainApplicationClass();
	}
```

---



#### run æµç¨‹

![1588311036777](SpringBoot.assets/1588311036777.png)

==å›¾ç‰‡å¯¹åº”çš„ä»£ç ==

```java
public ConfigurableApplicationContext run(String... args) {
       // è®¡æ—¶å™¨
        StopWatch stopWatch = new StopWatch();
        //  è®¡æ—¶å™¨å¯åŠ¨
        stopWatch.start();
//        åˆå§‹åŒ–ä¸Šä¸‹æ–‡ï¼Œå¼‚å¸¸æŠ¥å‘Šé›†åˆ
        ConfigurableApplicationContext context = null;
        Collection<SpringBootExceptionReporter> exceptionReporters = new ArrayList<>();
//        strep1 ç³»ç»Ÿå±æ€§è®¾ç½®
        configureHeadlessProperty();
        //  step2 åˆ›å»ºæ‰€æœ‰springç›‘å¬å™¨ï¼Œåº•å±‚é‡‡ç”¨factoriesInstancesï¼Œé€šè¿‡ç±»åŠ è½½å™¨è·å–spring.factoriesæ–‡ä»¶ï¼Œè¿›è€Œåå°„å¾—åˆ°classå¯¹è±¡
        SpringApplicationRunListeners listeners = getRunListeners(args);
//        å¯åŠ¨æ‰€æœ‰ç›‘å¬å™¨
        listeners.starting();
        try {
//            step4  è£…é…ç¯å¢ƒå‚æ•°ï¼ˆå¦‚service.port=8082ï¼‰
            ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);
//             ç”¨ç›‘å¬å™¨å’Œç¯å¢ƒå‚æ•°åˆ›å»ºé…ç½®ç¯å¢ƒ
            ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);
            configureIgnoreBeanInfo(environment);
//            step5 æ‰“å°bannerå’Œç¯å¢ƒ
            Banner printedBanner = printBanner(environment);
//            step 6åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡
            context = createApplicationContext();
//            å¼‚å¸¸æŠ¥å‘Š
            exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,
                    new Class[] { ConfigurableApplicationContext.class }, context);
//            åº”ç”¨ä¸Šä¸‹æ–‡å‡†å¤‡å®Œæ¯•
            prepareContext(context, environment, listeners, applicationArguments, printedBanner);
//            step9 ä¸Šä¸‹æ–‡åˆ·æ–°ï¼šbeanå·¥å‚åŠ è½½ï¼Œé€šè¿‡å·¥å‚ç”Ÿäº§Beanï¼Œåˆ·æ–°ç”Ÿå‘½å‘¨æœŸ
            refreshContext(context);
//              ä¸Šä¸‹æ–‡åç½®ç»“æŸå¤„ç†ï¼ˆä¸Šä¸‹æ–‡å’Œç¯å¢ƒå‚æ•°ï¼‰
            afterRefresh(context, applicationArguments);
//            è®¡æ—¶å™¨ç»“æŸ
            stopWatch.stop();
            if (this.logStartupInfo) {
                new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);
            }
//            ä¸Šä¸‹æ–‡çš„ç›‘å¬å®Œæˆ
            listeners.started(context);
//             step12 æ‰§è¡Œæ‰€æœ‰runnerè¿è¡Œå™¨
            callRunners(context, applicationArguments);
        }catch (Throwable ex) {
            handleRunFailure(context, ex, exceptionReporters, listeners);
            throw new IllegalStateException(ex);
        }

        try {
//          step13 å‘å¸ƒåº”ç”¨ä¸Šä¸‹æ–‡
            listeners.running(context);
        }
        catch (Throwable ex) {
            handleRunFailure(context, ex, exceptionReporters, null);
            throw new IllegalStateException(ex);
        }
//        step13 å°±ç»ªå¹¶è¿”å›
        return context;
    }
```



# 2.é…ç½®æ–‡ä»¶

springBootçš„é…ç½®æ–‡ä»¶æœ‰ä¸¤ç§

![1588341092753](SpringBoot.assets/1588341092753.png)

## properties

è¯­æ³•ç»“æ„   key = value

```properties
service.port = 8081
```

å¦‚æœä½¿ç”¨propertieså’Œç±»ç»‘å®š

```java
// åŠ è½½æŒ‡å®šé…ç½®æ–‡ä»¶
@PropertySource(value = "classpath:student.properties")
public class Student {

//    ä½¿ç”¨propertiesæ–‡ä»¶è®¾ç½®å±æ€§
    @Value("${student.name}")
     private String name;
```



## yaml

>  è¯­æ³•ç»“æ„  : key : ç©ºæ ¼ value

ç©ºæ ¼çš„è¦æ±‚éå¸¸ä¸¥æ ¼ï¼Œ**å‚ç›´å¯¹é½**ï¼Œå±æ€§éœ€è¦**ç¼©è¿›**

```yml
service:
   port: 8081
```

>  å¯¹è±¡

```yaml
student:
  name: YY
  age: 22
  
#è¡Œå†…å†™æ³•
student1: {name: YY,age: 22}
```

> æ•°ç»„

```
#æ•°ç»„
pets:
  - cat
  - dog
  - pig

pets1: [cat,dog,pig]
```

### å±æ€§èµ‹å€¼

 pojo

```java
//å‰æï¼Œè¿™ä¸ªç±»æ˜¯ç»„ä»¶
@Component
//å°†é…ç½®æ–‡ä»¶çš„æ¯ä¸€ä¸ªå±æ€§æ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ï¼Œå°†æœ¬ç±»çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­çš„ç›¸å…³é…ç½®ï¼ˆstudentä¸‹çš„æ‰€æœ‰å±æ€§ï¼‰å¯¹åº”ç»‘å®š
@ConfigurationProperties(prefix = "student")
public class Student {
    private String name;
    private int age;
```

test

```java
@SpringBootTest
class DemoApplicationTests {
    @Autowired
    Student student;

    @Test
    void contextLoads() {
        System.out.println(student.getAge());
    }

}
```



### æ¾æ•£ç»‘å®š

æ•°æ®åº“å­—æ®µålast-name  å¯ä»¥å’Œ é©¼å³°å‘½åæ³•lastName è‡ªåŠ¨ç»‘å®š

```
private String LastName;
```



### JSR303æ•°æ®æ ¡éªŒ

**éœ€è¦å…ˆå¼€å¯@validateæ•°æ®æ ¡éªŒ**

![1588342848385](SpringBoot.assets/1588342848385.png)



```
//æ•°æ®æ ¡éªŒ
@Validated
public class Student {

    @Email(message = "ğŸ“ªerror")
    private String name;
```



## å¤šç¯å¢ƒé…

### ä¼˜å…ˆçº§

![1588344302070](SpringBoot.assets/1588344302070.png)

### æŒ‡å®šç¯å¢ƒ

> å¤šæ–‡ä»¶

![1588344991080](SpringBoot.assets/1588344991080.png)

```properties
#springbootçš„å¤šç¯å¢ƒé…ç½®ï¼Œå¯ä»¥é€‰æ‹©æ¿€æ´»å“ªä¸€ä¸ª
spring.profiles.active=work
```

> å•æ–‡ä»¶

```yaml
#springbootçš„å¤šç¯å¢ƒé…ç½®ï¼Œå¯ä»¥é€‰æ‹©æ¿€æ´»å“ªä¸€ä¸ª
spring:
  profiles:
    active: test
#ä½¿ç”¨---åˆ†å‰²
---
server:
  port: 8083
spring:
  profiles: test

---
server:
  port: 8082
spring:
  profiles: work
---
server:
  port: 8084
spring:
  profiles: up

```



## é”™è¯¯

1. æŠŠserver å†™æˆservice å¯¼è‡´ç«¯å£ä¿®æ”¹æ²¡æœ‰ç”Ÿæ•ˆ
2. å•æ–‡ä»¶é…ç½®å¤šç¯å¢ƒæ—¶ï¼Œæ–‡ä»¶åå¿…é¡»æ˜¯



## é…ç½®ç±»

**è‡ªåŠ¨é…ç½®ç±»**ä¸ºXXXAutoConfiguration

**é…ç½®ç±»å**ä¸ºXXProperties

> EnableConfigurationProperties

==ä½œç”¨==ï¼š**è‡ªåŠ¨é…ç½®ç±»**ä¼šå°†**é…ç½®ç±»**æ‰€åœ¨çš„åŒ…æ³¨å†Œï¼Œå¹¶è®¾é»˜è®¤å€¼

![1588346645924](SpringBoot.assets/1588346645924.png)



> ConfigurationProperties

**é…ç½®ç±»**å’Œé…ç½®æ–‡ä»¶ç»‘å®š

![1588347315440](SpringBoot.assets/1588347315440.png)

> å¼•å…¥é…ç½®ç±»çš„æ¡ä»¶

å½“æ‰€æœ‰æ¡ä»¶æˆç«‹ï¼Œ**è‡ªåŠ¨é…ç½®ç±»**æ‰ä¼š**ç”Ÿæ•ˆ**ï¼Œæ‰èƒ½å°†é…ç½®ç±»**æ³¨å†Œ**è¿›IOCå®¹å™¨

![](SpringBoot.assets/QQå›¾ç‰‡20200501201143.png)



> æ‰‹åŠ¨é…ç½®å‚æ•°

![1588335522544](SpringBoot.assets/1588335522544.png)

![1588335764204](SpringBoot.assets/1588335764204.png)

prefixå¯¹åº”çš„å°±æ˜¯é…ç½®ç±»åï¼Œç„¶åè®¾ç½®å®ƒçš„å±æ€§

```properties
#è®¾ç½®é…ç½®ç±»çš„å±æ€§,é…ç½®ç±»çš„Configurationå’Œé…ç½®æ–‡ä»¶ç»‘å®šï¼Œé‚£ä¹ˆprefixå¯¹åº”çš„å°±æ˜¯ç±»åï¼Œå°±å¯ä»¥è®¾ç½®ç±»åçš„å±æ€§
spring.data.web.page = 10
```



### æŸ¥çœ‹ç”Ÿæ•ˆçš„é…ç½®ç±»

```yaml
debug: true
```

positive matchï¼šæ˜¾ç¤ºç”Ÿæ•ˆçš„é…ç½®ç±»

nagative matchï¼šæ˜¾ç¤ºæœªç”Ÿæ•ˆçš„é…ç½®ç±»



# 3.Webå¼€å‘

éœ€è¦è§£å†³çš„é—®é¢˜

- å¯¼å…¥é™æ€èµ„æº
- é¦–é¡µ
- jspï¼Œæ¨¡æ¿å¼•æ“thymeleaf
- è£…é…æ‰©å±•springMVC
- ä¸šåŠ¡
- æ‹¦æˆªå™¨
- å›½é™…åŒ–



## å¯¼å…¥é™æ€èµ„æº

>  WebMVCConfiguration.class

æ‰¾åˆ°addResourceHandleræ–¹æ³•

```java
@Override
		public void addResourceHandlers(ResourceHandlerRegistry registry) {
            //åˆ¤æ–­é™æ€èµ„æºæ˜¯å¦å·²è‡ªåŠ¨é…ç½®
			if (!this.resourceProperties.isAddMappings()) {
				logger.debug("Default resource handling disabled");
				return;
			}
			Duration cachePeriod = this.resourceProperties.getCache().getPeriod();
			CacheControl cacheControl = this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();
            // åˆ¤æ–­èµ„æºæ˜¯å¦é…ç½®åˆ°ä¸€ä¸‹è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè®¾ç½®åˆ°è¯¥è·¯å¾„
			if (!registry.hasMappingForPattern("/webjars/**")) {
		customizeResourceHandlerRegistration(registry.addResourceHandler("/webjars/**")
						.addResourceLocations("classpath:/META-INF/resources/webjars/")
						.setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));
			}
            //  è·å–é™æ€èµ„æºçš„è·¯å¾„ 
			String staticPathPattern = this.mvcProperties.getStaticPathPattern();
			if (!registry.hasMappingForPattern(staticPathPattern)) {
				customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)
						.addResourceLocations(getResourceLocations(this.resourceProperties.getStaticLocations()))
						.setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));
			}
		}
```

1. è®¿é—®webjarç›®å½•ï¼Œé€šè¿‡mavenå¼•å…¥çš„jaråŒ…éƒ½æ˜¯è¿™ç§æ–¹å¼

```java
/webjars/å°±æ˜¯ä¸‹é¢çš„ç¼©å†™
classpath:/META-INF/resources/webjars/
```

![1588406376314](SpringBoot.assets/1588406376314.png)

2. è·å–é¡¹ç›®**é™æ€èµ„æºè·¯å¾„** 

   **this.mvcProperties.getStaticPathPattern();**

```java

String staticPathPattern = this.mvcProperties.getStaticPathPattern();
//è¿™å¥è¯åœ¨ç‚¹è¿›getStaticPathPattern();æ–¹æ³•å
// /** å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½è¯†åˆ«ï¼Œå³èµ„æºç›®å½•
private String staticPathPattern = "/**";
// è¢«è¯†åˆ«çš„ç›®å½•ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ä¸Šé¢é‚£ä¸ªjaræŠ¥çš„
private static final String[] CLASSPATH_RESOURCE_LOCATIONS = { 
  "classpath:/META-INF/resources/"  , "classpath:/resources/", 
    "classpath:/static/",   "classpath:/public/" };
```

å‰©ä¸‹ä¸‰ä¸ªï¼šå¯¹åº”èµ„æºç›®å½•ä¸‹çš„ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼ˆå¯æ‰‹åŠ¨åˆ›å»ºï¼‰

![1588407745214](SpringBoot.assets/1588407745214.png)

> æ€»ç»“

é€šè¿‡æºç ï¼Œæˆ‘ä»¬çŸ¥é“4ç§æ–¹å¼å¤„ç†é™æ€èµ„æº

- webjar ç¬¬ä¸‰å‘jaråŒ…			è®¿é—®è·¯å¾„ï¼šlocalhost:8080/webjar/æ–‡ä»¶å
- public,static,resources  ä¸‰ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶    è®¿é—®è·¯å¾„ï¼šlovalhost:8080/æ–‡ä»¶å

ä¼˜å…ˆçº§ï¼šresource > static(é»˜è®¤) > public 









## æ¨¡æ¿å¼•æ“

> ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“

 æ˜¯ä¸ºäº†ä½¿ç”¨æˆ·ç•Œé¢ä¸ä¸šåŠ¡æ•°æ®ï¼ˆå†…å®¹ï¼‰åˆ†ç¦»è€Œäº§ç”Ÿçš„ï¼Œå®ƒå¯ä»¥ç”Ÿæˆç‰¹å®šæ ¼å¼çš„æ–‡æ¡£ï¼Œç”¨äºç½‘ç«™çš„æ¨¡æ¿å¼•æ“å°±ä¼šç”Ÿæˆä¸€ä¸ªæ ‡å‡†çš„[HTML](https://baike.baidu.com/item/HTML/97049)æ–‡æ¡£ ï¼Œæ¯”å¦‚JSPå°±æ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ã€‚

**æœ‰æ—¶å€™ç»å¸¸éœ€è¦æ ¹æ®åç«¯è¿”å›çš„jsonæ•°æ®ï¼Œç„¶åæ¥ç”Ÿæˆhtmlï¼Œå†æ¸²æŸ“é¡µé¢ã€‚**ï¼Œæ¨¡æ¿å¼•æ“å°±æ˜¯å†™ä¸€ä¸ªé¡µé¢æ¨¡æ¿ï¼Œå°†ä¸€äº›åŠ¨æ€çš„å€¼ä¹Ÿèƒ½é€šè¿‡è¡¨è¾¾å¼å¡«å……åˆ°æŒ‡å®šä½ç½®



> å¯¼å…¥ä¾èµ–

```xml
<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
```



> æºç 

ThymeleafProperties.class

ç›¸å½“äº**è§†å›¾è§£æå™¨**ï¼Œä¸ºèµ„æºåŠ ä¸Šå‰ç¼€åç¼€

```java
@ConfigurationProperties(prefix = "spring.thymeleaf")
public class ThymeleafProperties {

	private static final Charset DEFAULT_ENCODING = StandardCharsets.UTF_8;

    //æŒ‡å®šçš„è·¯å¾„ä¸ºtemplatesï¼Œå‰ç¼€å³ä¸ºè·¯å¾„
	public static final String DEFAULT_PREFIX = "classpath:/templates/";

    //æ–‡ä»¶åç¼€ä¸ºhtml
	public static final String DEFAULT_SUFFIX = ".html";
```

> èµ„æºä½ç½® tempates

é€šè¿‡controllerè·³è½¬èµ„æºï¼Œéœ€è¦æŠŠèµ„æºæ”¾åˆ°**templatesç›®å½•ä¸‹**

è€Œä¸”**templatesçš„èµ„æºåªå…è®¸controllerè®¿é—®**

![1588435240222](SpringBoot.assets/1588435240222.png)



> controller

**è§†å›¾å**ï¼šclasspath:/templates/æ–‡ä»¶å.html

```java
//   templatesç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æºï¼Œåªæœ‰controlleræ‰èƒ½è®¿é—®
//   å› ä¸ºæ²¡æœ‰è§†å›¾è§£æå™¨ï¼Œæ‰€ä»¥éœ€è¦æ¨¡æ¿å¼•æ“çš„æ”¯æŒ thymeleaf
@Controller
public class IndexController {

    
//    è®¾ç½®é¦–é¡µ
    @RequestMapping("/index")
    public String index(){
        return "index";
    }
    
   @RequestMapping("/test")
    public String test(Model model){
        model.addAttribute("message","YY");
        List<Object> lists = new ArrayList();
        lists.add("YZY");
        lists.add("YY");
//        æ¨¡æ¿å¼•æ“å°†è§†å›¾åæ‹¼æ¥æˆclasspath:/templates/test.html
        return "test";
    }
}
```

> è·å–å‚æ•°

```
<h1>test</h1>
<!--ç›´æ¥è¾“å‡ºå¯èƒ½ä¸ä¼šæ˜¾ç¤º-->
${message}
```

![1588435754010](SpringBoot.assets/1588435754010.png)

æ”¹è‰¯ç‰ˆ

```html
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<!--ä½¿ç”¨thymeleafè¯­æ³•ï¼Œç±»ä¼¼vue
            th:å±æ€§-->
<p th:text="${message}"></p>
```

![1588436048058](SpringBoot.assets/1588436048058.png)

### è¯­æ³•

![1588476515969](SpringBoot.assets/1588476515969.png)

```html
<!--éå†é›†åˆ-->
<h2 th:each="list:${lists}" th:text="${list}"></h2>
<!--ä¹Ÿå¯ä»¥å†™åœ¨å†…å®¹ä¸­-->
<h2 th:each="list:${lists}" >[[ ${list} ]]</h2>
```

>  è·å–é™æ€èµ„æºéœ€è¦@{è·¯å¾„}

```js
th:href = "@{/css/**}"
```

> å¤ç”¨ä»£ç :

å¤ç”¨ç»„ä»¶æ”¾åœ¨ä¸€ä¸ªå…¬ç”¨æ–‡ä»¶å†…ï¼Œå¹¶ç”¨thï¼šfragmentæ ‡è®°

```html
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0" th:fragment="navBar">

```

è°ƒç”¨commonæ–‡ä»¶å¤¹çš„commonæ–‡ä»¶ä¸­çš„sideBarç»„ä»¶

```html
th:insert = '@{common/common::sideBar}'
```

> åˆ¤æ–­

```html
	<td th:text="${employee.getGender()==0?'å¥³':'ç”·'}"></td>
```



## è®¾ç½®é¦–é¡µ

>  æºç webMVCConfiguration

WelcomePageHandlerMappingï¼šæ¬¢è¿ç•Œé¢ï¼ˆé¦–é¡µï¼‰æ˜ å°„

```java
public WelcomePageHandlerMapping welcomePageHandlerMapping(ApplicationContext applicationContext,
				FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider) {
			WelcomePageHandlerMapping welcomePageHandlerMapping = new WelcomePageHandlerMapping(
					new TemplateAvailabilityProviders(applicationContext), applicationContext, getWelcomePage(),
					this.mvcProperties.getStaticPathPattern());
			welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));
			return welcomePageHandlerMapping;
		}


		private Optional<Resource> getWelcomePage() {
            // è·å–èµ„æºç›®å½•
			String[] locations = getResourceLocations(this.resourceProperties.getStaticLocations());
			return Arrays.stream(locations).map(this::getIndexHtml).filter(this::isReadable).findFirst();
		}

//     è·å–é™æ€èµ„æºç›®å½•ä¸‹çš„index.html
		private Resource getIndexHtml(String location) {
			return this.resourceLoader.getResource(location + "index.html");
		}
```

å¯ä»¥å§é¦–é¡µæ”¾åœ¨èµ„æºç›®å½•çš„ä¸‰ä¸ª**é™æ€èµ„æºæ–‡ä»¶å¤¹**å†…

![1588416985284](SpringBoot.assets/1588416985284.png)

**æ˜ å°„æˆåŠŸ**

![1588418234051](SpringBoot.assets/1588418234051.png)

## æ‰©å±•MVC

æ‰©å±•MVCåŠŸèƒ½å¯ä»¥ä¼ å»ºä¸€ä¸ªMVCé…ç½®ç±»ï¼Œå¯ä»¥**æ¥ç®¡**è‡ªåŠ¨é…ç½®ç±»é‡Œçš„**æŸäº›åŠŸèƒ½**ï¼Œä¸å¯å…¨é¢æ¥ç®¡@EnableWebMVC



> æºç 

```java
public View resolveViewName(String viewName, Locale locale) throws Exception {
		RequestAttributes attrs = RequestContextHolder.getRequestAttributes();
		Assert.state(attrs instanceof ServletRequestAttributes, "No current ServletRequestAttributes");
		List<MediaType> requestedMediaTypes = getMediaTypes(((ServletRequestAttributes) attrs).getRequest());
		if (requestedMediaTypes != null) {
            //   è·å–springbootä¸­çš„æ‰€æœ‰è§£æå™¨
			List<View> candidateViews = getCandidateViews(viewName, locale, requestedMediaTypes);
            //  é€‰æ‹©å‡ºæœ€å¥½çš„è§†å›¾è§£æå™¨
			View bestView = getBestView(candidateViews, requestedMediaTypes, attrs);
			if (bestView != null) {
				return bestView;
			}
		}
```



> è‡ªå·±å†™ä¸€ä¸ªè§†å›¾è§£æå™¨

```java
//å¦‚æœåŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼ŒwebMVCè‡ªåŠ¨é…ç½®ç±»å°±ä¼šå¤±æ•ˆ
@EnableWebMvc
public class webMVCConfig implements WebMvcConfigurer {

//    ä¼šæŠŠè‡ªå·±å†™çš„è§†å›¾è§£æå™¨ä¹Ÿè£…é…åˆ°ç¯å¢ƒçš„è§†å›¾è§£æå™¨é‡Œ
    @Bean
    public ViewResolver view(){
        return new MyViewResolver();
    }

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/springboot").setViewName("test");
    }
}
//å®šä¹‰ä¸€ä¸ªè‡ªå·±å†™çš„è§†å›¾è§£æå™¨
class MyViewResolver implements ViewResolver{
//
    @Override
    public View resolveViewName(String s, Locale locale) throws Exception {
        return null;
    }


}
```

> ä¸å¯ä»¥åŠ ä¸Š@EnableWebMVC

webMVCConfigurationæ–‡ä»¶é‡Œæœ‰è¿™æ ·ä¸€å¥è¯ï¼š

```java
//å½“ä¸å­˜åœ¨è¿™ä¸ªWebMvcConfigurationSupport.classæ—¶æ¡ä»¶æˆç«‹
@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)
```

å¦‚æœåŠ ä¸Šï¼Œç‚¹å…¥æ³¨è§£

```java
// ç‚¹å…¥é…ç½®ç±»
@Import(DelegatingWebMvcConfiguration.class)
public @interface EnableWebMvc {
}

```

ç‚¹å…¥é…ç½®ç±»ï¼Œå‘ç°è¿™ä¸ªç±»**ç»§æ‰¿WebMvcConfigurationSupport**

```java
public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport {
```

è¿™å°±å’Œå‰é¢çš„è‡ªåŠ¨é…ç½®ç±»å†²çªï¼Œå¯¼è‡´è‡ªåŠ¨é…ç½®ç±»é…ç½®ç±»å¤±æ•ˆ



## ä¸šåŠ¡

æ¨¡æ‹Ÿæ•°æ®åº“

> è¡¨

```java
//éƒ¨é—¨è¡¨
public class Department {

    private Integer id;
    private String departmentName;
```

```java
//å‘˜å·¥è¡¨
public class Employee {

    private Integer id;
    private String lastName;
    private String email;
//    æ€§åˆ« å¥³ï¼š0 ç”·ï¼š1
    private Integer gender;
    private Department department;
    private Date birth;
```

> ä¸šåŠ¡å±‚

```java
@Repository
public class DepartmentDao {

//    æ¨¡æ‹Ÿæ•°æ®
    private static Map<Integer, Department> departmentMap = null;
    static{
        departmentMap = new HashMap<>();
        departmentMap.put(1,new Department(101,"å¼€å‘"));
        departmentMap.put(2,new Department(102,"è¿ç»´"));
        departmentMap.put(3,new Department(103,"æµ‹è¯•"));
    }

//    ä¸šåŠ¡
//    è·å–æ‰€æœ‰éƒ¨é—¨ä¿¡æ¯
    public Collection<Department> findAllDepartment(){
        return departmentMap.values();
    }

//    é€šè¿‡idè·å–éƒ¨é—¨ä¿¡æ¯
    public Department findDepartMentByID(Integer id){
        return departmentMap.get(id);
    }

}
```

```java
@Repository
public class EmployeeDap {

    private static Map<Integer , Employee> employeeMap= null;
//    å‘˜å·¥æ‰€å±çš„éƒ¨é—¨
    @Autowired
    private DepartmentDao departmentDao;

    static{
        employeeMap = new HashMap<>();
        employeeMap.put(1,new Employee(1,"YZY","email1",1,new Department(1,"å¼€å‘")));
        employeeMap.put(2,new Employee(2,"YY","email2",0,new Department(2,"è¿ç»´")));
        employeeMap.put(3,new Employee(3,"JJ","email3",0,new Department(1,"å¼€å‘")));
        employeeMap.put(4,new Employee(4,"HC","email4",1,new Department(3,"æµ‹è¯•")));
    }

//    ä¸šåŠ¡\
//    ä¸»é”®è‡ªå¢
    private static Integer initid = 5;
//    å¢åŠ ä¸€ä¸ªå‘˜å·¥
    public void addEmployee(Employee employee){
        employeeMap.put(initid++,employee);
    }
//    åˆ é™¤ä¸€ä¸ªå‘˜å·¥
    public void deleteEmployee(Integer id){
        employeeMap.remove(id);
    }
//    ä¿®æ”¹å‘˜å·¥
    public void updateEmployee(Employee employee){
        employeeMap.replace(employee.getId(),employee);
    }
//    æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥
    public Collection<Employee> findAllEmloyee(){
       return employeeMap.values();
    }
//    é€šè¿‡idæŸ¥æ‰¾å‘˜å·¥
    public Employee findEmloyeeById(Integer id){
        return employeeMap.get(id);
    }

}
```



å¦‚æœç›´æ¥æŠŠä¸»é¡µè·³è½¬æ”¾åœ¨controllerå±‚ï¼Œ**é¡µé¢çš„æ ·å¼ä¸ä¼šåŠ è½½**





## å›½é™…åŒ–

ç™»å½•ç•Œé¢å¯ä»¥åˆ‡æ¢ä¸­æ–‡å’Œè‹±æ–‡

![1588513543101](SpringBoot.assets/1588513543101.png)



æƒ³è¦åˆ‡æ¢ï¼Œå°±éœ€è¦ä¸€ä¸ªé…ç½®ç±»ï¼š

> MyLocaleResolveré…ç½®ç±»

```java
@Configuration
public class MyLocaleResolver implements LocaleResolver {

    @Override
    public Locale resolveLocale(HttpServletRequest request) {
//        è·å¾—è¯­è¨€åˆ‡æ¢çš„å‚æ•°è¯·æ±‚
        String language = request.getParameter("language");
//        é»˜è®¤
        Locale locale = Locale.getDefault();
//        å¦‚æœæºå¸¦äº†å‚æ•°ï¼Œå°±èµ‹å€¼è¿”å›
        if(!StringUtils.isEmpty(language))
        {
//            _åˆ†å‰²ï¼šè¯­è¨€ï¼Œå›½å®¶
            String[] split = language.split("_");
            locale = new Locale(split[0],split[1]);
        }
        return locale;
    }

    @Override
    public void setLocale(HttpServletRequest request, HttpServletResponse response, Locale locale) {

    }
}
```

> MyWebMVCConfig

```java
@Configuration
public class MyMVCConfig implements WebMvcConfigurer {
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
        registry.addViewController("/index.html").setViewName("index");
    }

//    è‡ªå®šä¹‰çš„å›½é™…åŒ–ç»„ä»¶ç”Ÿæ•ˆ
    @Bean
    public LocaleResolver localeResolver(){
        return new MyLocaleResolver();
    }
}
```

> application.yaml

```yaml
#æ ‡æ³¨å›½é™…åŒ–æ–‡ä»¶ä½ç½®
spring:
  messages:
    basename: i18n.login
```



## æ‹¦æˆªå™¨

> åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨çš„ç±»

```java
public class LoginInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String loginname = (String) request.getSession().getAttribute("loginname");
        if (loginname.length() != 0) {
            request.setAttribute("message","è¿˜æœªç™»é™†ï¼Œæ— æ³•è®¿é—®");
            request.getRequestDispatcher("/index.html").forward(request,response);
            return true;
        } else {
            return false;
        }
    }
}
```

> åœ¨webMVCConfigurationé…ç½®æ‹¦æˆªå™¨

```java
//æ·»åŠ è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
//                               æ‹¦æˆªå…¨éƒ¨è¯·æ±‚ï¼Œé™¤äº†ä¸»é¡µå’Œç™»å½•è¯·æ±‚,è¿˜æœ‰é™æ€èµ„æº
        registry.addInterceptor(new LoginInterceptor()).addPathPatterns("/**")
           .excludePathPatterns("/index.html","/","/login","/css/**","/img/**","/js/**");
    }
```



## é¡µé¢åŠŸèƒ½ï¼ˆä»…çº¯javaä»£ç ï¼‰

ä¸å…·å¤‡æŒä¹…æ€§ï¼Œå³é‡å¯æœåŠ¡é‡ç½®æ•°æ®

### å‰ç«¯æµç¨‹

- åˆ›å»ºéœ€è¦çš„ç½‘é¡µ

- è°ƒç”¨å…¬å…±å…ƒç´ å’Œç¼–å†™å…¶ä»–å…ƒç´ 

- å°†ç½‘é¡µæ”¾å…¥webMVCConfigå†…ç®¡ç†

  ```java
  //    ç®¡ç†è·³è½¬é“¾æ¥ï¼Œå› ä¸ºitemplatesä¸å…è®¸å¤–éƒ¨è®¿é—®
      @Override
      public void addViewControllers(ViewControllerRegistry registry) {
          registry.addViewController("/").setViewName("index");
          registry.addViewController("/index.html").setViewName("index");
          registry.addViewController("/main.html").setViewName("dashboard");
          registry.addViewController("/list.html").setViewName("list");
          registry.addViewController("/addE.html").setViewName("addE");
          registry.addViewController("/updateE.html").setViewName("updateE");
      }
  ```

- ä¸ä¸šåŠ¡è¿æ¥



### æå–å…¬å…±å…ƒç´ ï¼ˆä¾§è¾¹æ å’Œå¯¼èˆªæ ï¼‰

1.æå–åˆ°ä¸€ä¸ªå…¬å…±æ–‡ä»¶**common/common.html**

```html
<!--å¤´éƒ¨å¯¼èˆªæ -->
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0" th:fragment="navBar">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="http://getbootstrap.com/docs/4.0/examples/dashboard/#">æ¬¢è¿ç”¨æˆ·ï¼š[[${session.loginname}]]</a>
    <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
    <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
            <a class="nav-link" href="http://getbootstrap.com/docs/4.0/examples/dashboard/#">æ³¨é”€</a>
        </li>
    </ul>
</nav>


<!--ä¾§è¾¹å¯¼èˆªæ -->
<nav class="col-md-2 d-none d-md-block bg-light sidebar" th:fragment="sideBar">
    
    
    <!--å…¬å…±å…ƒç´ ä¸­æ¥æ”¶å‚æ•°å¹¶åˆ¤æ–­-->
    					<a th:class="${active=='list.html'?'nav-link active':'nav-link'}"></a>

```

2.å…¶ä»–é¡µé¢**è°ƒç”¨**ï¼ˆå¯å¸¦å‚æ•°ï¼‰ï¼Œä¼šåœ¨commoné¡µé¢åˆ¤æ–­

```html
<!--	å¤´éƒ¨å¯¼èˆªæ -->
<div th:replace="~{common/common::navBar}"></div>
<!--				ä¾§è¾¹æ ,å¸¦å‚æ•°-->
			<div th:replace="~{common/common::sideBar(active='main.html')}"></div>
```



### ç™»å½•

1.ç™»å½•é¡µé¢å¡«å†™è´¦æˆ·å¯†ç ï¼Œ**å›½é™…åŒ–åŠŸèƒ½**å¯ä»¥æ”¯æŒä¸­è‹±æ–‡

2.è°ƒç”¨ç™»å½•ä¸šåŠ¡ï¼Œ**æˆåŠŸè·³è½¬é¦–é¡µ**ï¼Œä¸æˆåŠŸ**è¿”å›ç™»å½•é¡µé¢**å¹¶è¿”å›ä¿¡æ¯

```java
@RequestMapping("/login")
    public String login(String username, String password, Model model, HttpSession session) {
        if (username.length() != 0 && "1".equals(password)) {
            session.setAttribute("loginname",username);
            return "redirect:/main.html";
        }else{
            model.addAttribute("message","ç™»å½•å¤±è´¥");
            return "index";
        }
    }
```









### æ˜¾ç¤ºæ‰€æœ‰èŒå‘˜ä¿¡æ¯

1.**å¤ç”¨ä¾§è¾¹æ **è·³è½¬**æ‰§è¡Œæ˜¾ç¤ºæ‰€æœ‰èŒå‘˜ä¿¡æ¯çš„ä¸šåŠ¡**å¹¶è¿”å›**å‘˜å·¥ä¿¡æ¯é¡µé¢**

```java
@RequestMapping("/getAllEmployees")
    public String getAllEmployees(Model model){
        Collection<Employee> allEmloyees = employeeDao.findAllEmloyee();
        model.addAttribute("allEmloyees",allEmloyees);
        return "list";
    }
```



2.å‘˜å·¥ä¿¡æ¯é¡µé¢ï¼Œ**è·å–ä¸šåŠ¡å‚æ•°å¹¶éå†æ˜¾ç¤º**

```html
<tbody>
	<!--		th:each="éå†å‡ºæ¥çš„ä¸ªä½“:${è·å–çš„éå†æ•°æ®}"					-->
					<tr th:each="employee:${allEmloyees}">
					<td th:text="${employee.getId()}"></td>
					<td th:text="${employee.getLastName()}"></td>
					<td th:text="${employee.getEmail()}"></td>
					<td th:text="${employee.getGender()==0?'å¥³':'ç”·'}"></td>
				<td th:text="${employee.getDepartment().getDepartmentName()}"></td>
				<td th:text="${#dates.format(employee.getBirth(),'yyyy-MM-dd HH:mm:ss')}"></td>
				<td>
					<button class="btn btn-sm btn-primary">ä¿®æ”¹</button>
					<button class="btn btn-sm btn-danger">åˆ é™¤</button>
									</td>
								</tr>
							</tbody>
```



3.æä¾›**é€šè¿‡å‘˜å·¥id**è¿›è¡Œ**ä¿®æ”¹**å’Œ**åˆ é™¤**



### æ·»åŠ èŒå‘˜

1.ä»é¦–é¡µé€šè¿‡**å¤ç”¨çš„ä¾§è¾¹**è·³è½¬ï¼ˆ**è·³è½¬æ—¶æ‰§è¡ŒæŸ¥è¯¢éƒ¨é—¨ä¸šåŠ¡**ï¼‰åˆ°æ·»åŠ èŒå‘˜ç•Œé¢

```java
@RequestMapping("/toaddE")
    public String addE(Model model){
        Collection<Department> allDepartment = departmentDao.findAllDepartment();
        model.addAttribute("allDepartment",allDepartment);
        return "addE";
    }
```



2.æ·»åŠ èŒå‘˜ç•Œé¢æœ‰ä¸€ä¸ªå¡«å†™ä¿¡æ¯çš„è¡¨å•ï¼ˆæ˜¾ç¤ºå¡«å†™çš„ä¿¡æ¯ï¼‰

```html
<main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
            <h2>æ·»åŠ å‘˜å·¥ä¿¡æ¯</h2>
            <form th:action="@{/addEmployee}">
                <div class="form-group">
                    <label>LastName</label>
                    <input type="text" name="lastName" class="form-control" placeholder="é¡½ç–¾">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" class="form-control" placeholder="1061603811@qq.com">
                </div>
                <div class="form-group">
                    <label>Gender</label><br>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" value="1">
                        <label class="form-check-label">ç”·</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" value="0">
                        <label class="form-check-label">å¥³</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>department</label>
                    <select name="department.id" class="form-control" >
                        <option th:each="Department:${allDepartment}" th:text="${Department.getDepartmentName()}" th:value="${Department.getId()}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label>birth</label>
                        <input type="text" name="birth" class="form-control" placeholder="1998/12/12">
                </div>
                <button type="submit" class="btn btn-primary">æ·»åŠ </button>
            </form>
        </main>
```



3.è¡¨å•ä¸­çš„**é€‰æ‹©éƒ¨é—¨**æ¥æ”¶è·³è½¬å‚æ•°ï¼Œéå†å‚æ•°å¹¶èµ‹å€¼éƒ¨é—¨idç»™æ¯ä¸ªä¸‹æ‹‰æ¡†

```html
 <select name="department.id" class="form-control" >
                        <option th:each="Department:${allDepartment}" th:text="${Department.getDepartmentName()}" th:value="${Department.getId()}"></option>
                    </select>
```



4.æäº¤ä¹‹å**è°ƒç”¨addEmployeeä¸šåŠ¡**ï¼Œæ·»åŠ èŒå‘˜ä¿¡æ¯ä¹‹ååœ¨**è·³è½¬æ˜¾ç¤ºæ‰€æœ‰èŒå‘˜ä¿¡æ¯**

```java
@RequestMapping("/addEmployee")
    public String addEmployee(Employee employee){
//        æ·»åŠ å‘˜å·¥ä¿¡æ¯
        employeeDao.addEmployee(employee);
        return "redirect:/getAllEmployees";
    }
```



> é—®é¢˜

1.birthæ ¼å¼

â€‹		birthåœ¨MVC**é»˜è®¤ä¸­çš„æ ¼å¼**æ˜¯yyyy/MM/dd,å¯ä»¥åœ¨application.yamlä¸­è®¾ç½®æˆ-çš„æ ¼å¼

```yaml
#æ—¶é—´æ—¥æœŸçš„æ ¼å¼
spring: 
  mvc:
    date-format: yyyy-MM-dd
```

â€‹      åœ¨æ˜¾ç¤ºå‘˜å·¥ä¸­ç”¨åˆ°è¿‡ç±»ä¼¼çš„è¯­å¥ï¼Œä½†æ˜¯æ˜¯javaè½¬æ¢

```html
<td th:text="${#dates.format(employee.getBirth(),'yyyy-MM-dd HH:mm:ss')}"></td>
```

2.æäº¤è¡¨å•æ—¶éƒ¨é—¨æäº¤çš„å‚æ•°åº”è¯¥æ˜¯department.id

â€‹		å¦‚æœæäº¤çš„æ˜¯departmentå°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºæˆ‘ä»¬èµ‹ç»™ä¸‹æ‹‰æ¡†çš„å€¼æ˜¯idçš„å€¼ï¼Œæ‰€ä»¥æäº¤çš„å€¼ä¹Ÿåº”è¯¥æ˜¯id





### ä¿®æ”¹å‘˜å·¥ä¿¡æ¯

1.ä¿®æ”¹æŒ‰é’®æ“ä½œåœ¨æ˜¾ç¤ºå‘˜å·¥æ–°çš„å³ä¾§

```html
<a class="btn btn-sm btn-primary" th:href="@{/toupdateE(id=${employee.getId()})}">ä¿®æ”¹</a>
```

2.ç‚¹å‡»æºå¸¦è¯¥å‘˜å·¥idå‚æ•°æ‰§è¡Œä¿®æ”¹ä¿®æ”¹ä¸šåŠ¡

```java
//  è·³è½¬ä¿®æ”¹é¡µé¢
    @RequestMapping("/toupdateE")
    public String toupdateE(Integer id,Model model){
        Employee emloyeeById = employeeDao.findEmloyeeById(id);
        Collection<Department> allDepartment = departmentDao.findAllDepartment();
        model.addAttribute("emloyeeById",emloyeeById);
        model.addAttribute("allDepartment",allDepartment);
        return "updateE";
    }
```

3.ä¿®æ”¹é¡µé¢é»˜è®¤æä¾›å‘˜å·¥çš„åŸæœ¬ä¿¡æ¯ï¼ˆidéšè—ï¼‰

```html
<main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
    <h2>ä¿®æ”¹å‘˜å·¥ä¿¡æ¯</h2>
    <form th:action="@{/updateEmployee}">
        <input type="hidden" name="id"  th:value="${emloyeeById.getId()}">
        <div class="form-group">
            <label>LastName</label>
            <input type="text" name="lastName" class="form-control" th:value="${emloyeeById.getLastName()}">
        </div>
        <div class="form-group">
            <label>Email</label>
            <input type="email" name="email" class="form-control" th:value="${emloyeeById.getEmail()}">
        </div>
        <div class="form-group">
            <label>Gender</label><br>
            <div  class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="gender" value="1">
                <label class="form-check-label">ç”·</label>
            </div>
            <div  class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="gender" value="0">
                <label class="form-check-label">å¥³</label>
            </div>
        </div>
        <div class="form-group">
            <label>department</label>
            <select name="department.id" class="form-control" >
                <option th:selected="${Department.getId()==emloyeeById.getDepartment().getId()}" th:each="Department:${allDepartment}" th:text="${Department.getDepartmentName()}" th:value="${Department.getId()}"></option>
            </select>
        </div>
        <div class="form-group">
            <label>birth</label>
            <input type="text" name="birth" class="form-control" th:placeholder="${emloyeeById.getBirth()}">
        </div>
        <button type="submit" class="btn btn-primary">ä¿®æ”¹</button>
    </form>
</main>
```

4.ä¿®æ”¹æäº¤è¿”å›å‘˜å·¥é¡µé¢

```java
@RequestMapping("/updateEmployee")
    public String updateEmployee(Employee employee){
        employeeDao.updateEmployee(employee);
        return "redirect:/getAllEmployees";
    }
```



> é‡åˆ°çš„é—®é¢˜

1.ä¿®æ”¹å®Œæˆè¿”å›å‘˜å·¥ç•Œé¢æ—¶ï¼Œè·³è½¬å‡ºç°Whitelabel Error Page

â€‹		return è¿”å›çš„é¡µé¢éœ€è¦åŠ ä¸Šé‡å®šå‘  redirectï¼š/



2.ä¿®æ”¹ä¹‹ådepartmentæ æ˜¾ç¤ºç©º

â€‹		

3.buttonæ ‡ç­¾æ— æ³•è·³è½¬

â€‹		ä½¿ç”¨aæ ‡ç­¾ï¼Œbuttonæ— æ³•ä½¿ç”¨hrefåŠ¨ä½œ



### åˆ é™¤å‘˜å·¥

1.ä¿®æ”¹æŒ‰é’®æ“ä½œåœ¨æ˜¾ç¤ºå‘˜å·¥æ–°çš„å³ä¾§

```html
<a class="btn btn-sm btn-danger"  th:href="@{/todeleteE(id=${employee.getId()})}">åˆ é™¤</a>
```

2.è·³è½¬è°ƒç”¨åˆ é™¤ä¸šåŠ¡å¹¶è¿”å›å‘˜å·¥é¡µé¢

```java
//    åˆ é™¤
    @RequestMapping("/todeleteE")
    public String delete(Integer id){
        employeeDao.deleteEmployee(id);
        return "redirect:/getAllEmployees";
    }
```



### 404



![1588693443697](SpringBoot.assets/1588693443697.png)



# 4.spring Date

springboot æ‹¥æœ‰è‡ªå¸¦çš„jdbc ï¼š spring Date

## åˆ›å»º

1.åˆ›å»ºé¡¹ç›®é€‰æ‹©sqlé‡Œçš„JDBC API å’ŒMySQL Driver

![1588754290656](SpringBoot.assets/1588754290656.png)

2.æŸ¥çœ‹ä¾èµ–

```xml
<!--        jdbc-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-jdbc</artifactId>
        </dependency>

<!--        mysql driver-->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <scope>runtime</scope>
        </dependency>
```

3.åˆ›å»ºæ•°æ®åº“é…ç½®æ–‡ä»¶ï¼Œåç§°å¿…é¡»ä¸º application.yaml

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/springboot?useUnicode=true&characterEncoding=utf-8
    username: root
    password: yzy665128
    driver-class-name: com.mysql.cj.jdbc.Driver
```

4.æµ‹è¯•

```java
@SpringBootTest
class SpringbootDateApplicationTests {

    @Autowired
    DataSource dataSource;

    @Test
    void contextLoads() {
//        æŸ¥çœ‹ä½¿ç”¨çš„æ•°æ®åº“é©±åŠ¨          class com.zaxxer.hikari.HikariDataSource
        System.out.println(dataSource.getClass());
    }

}
```

5.ç‚¹å‡»é…ç½®æ–‡ä»¶çš„å±æ€§å¯ä»¥è¿›å…¥æºä»£ç æŸ¥çœ‹datesourceå±æ€§

6.æŸ¥çœ‹**jdbcæ¨¡æ¿**ï¼šå¯ä»¥é€šè¿‡å¼•å…¥åŒ…çš„AutoConfig->org->jdbc->jdbcTemplateConfiguration

7.ä½¿ç”¨Jdbctemplate

```java
@RestController
public class JDBCController {

    @Autowired
    JdbcTemplate jdbcTemplate;

    @RequestMapping("/s")
    public List<Map<String,Object>> s(){
        String sql = "select * from account";
        List<Map<String, Object>> list = jdbcTemplate.queryForList(sql);
        return list;
    }
//    resultfulä¼ å‚
    @RequestMapping("/u/{id}")
    public int u(@PathVariable("id") int id){
        Object[] o  =new Object[2];
        o[0] = "Y";
        o[1] = 1;
        String sql = "update account set name=? ,money = ? where id = "+id;
//        å ä½ç¬¦ä¼ å‚
        int update = jdbcTemplate.update(sql,o);
        return update;
    }
    @RequestMapping("/a")
    public int a(){
        Object[] o = new Object[3];
        o[0] = 17;
        o[1] = "JJ";
        o[2] = 17;
        String sql = "insert into account values(?,?,?)";
        int insert = jdbcTemplate.update(sql,o);
        return insert;
    }
    @RequestMapping("/d")
    public int d(){
        String sql = "delete from account where id = 17";
        int delete = jdbcTemplate.update(sql);
        return delete;
    }
}
```

8.ç»“æœ

![1588769619759](SpringBoot.assets/1588769619759.png)

## druid

1.å¯¼å…¥

```xml
<!-- https://mvnrepository.com/artifact/com.alibaba/druid -->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.1.21</version>
</dependency>
```

2.ä½¿ç”¨ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š

```yaml
spring:
  datasource:
   
    # æŒ‡å®šæ•°æ®æ± 
    type: com.alibaba.druid.pool.DruidDataSource
```

3.æµ‹è¯•

![1588771715007](SpringBoot.assets/1588771715007.png)

4.åˆ›å»ºdruidé…ç½®ç±»ï¼Œå¹¶è®¾ç½®å‰ç¼€ä¸é…ç½®æ–‡ä»¶çš„å±æ€§ç›¸è¿

```java
@Configuration
public class DruidConfig {

    @Bean
    @ConfigurationProperties(prefix = "spring.datasource")
    public DataSource druidDataSource(){
        return new DruidDataSource();
    }
}
```

5.é…ç½®ç±»é‡Œé…ç½®ç®¡ç†å‘˜

```java
//    åå°ç›‘æ§
    @Bean
//    å› ä¸ºspringbootå†…ç½®äº†tomcatï¼Œæ‰€ä»¥æ²¡æœ‰web.xmlï¼Œ ç”¨ServletRegistrationBeanæ›¿ä»£äº†è¿™ä¸ªåŠŸèƒ½
    public ServletRegistrationBean statViewServlet(){
        ServletRegistrationBean<StatViewServlet> bean = new ServletRegistrationBean<>(new StatViewServlet(), "/druid/*");

//        åå°éœ€è¦æœ‰äººç™»é™†
        HashMap<String, String> hashMap = new HashMap<>();
//          æ·»åŠ è´¦å·å’Œå¯†ç   keyçš„å€¼å›ºå®šä¸èƒ½å˜
        hashMap.put("loginUsername","admin");
        hashMap.put("loginPassword","123456");
//        å…è®¸è°å¯ä»¥è®¿é—®
        hashMap.put("allow","");



        bean.setInitParameters(hashMap);
        return bean;
    }
```

6.æµ‹è¯•

![1588776896730](SpringBoot.assets/1588776896730.png)

7.ç™»å½•ï¼Œå½“æ‰§è¡Œä¸€æ¡æœç´¢è¯­å¥æ—¶ï¼Œä¼šæ˜¾ç¤ºè®°å½•

![1588777269100](SpringBoot.assets/1588777269100.png)









## é‡åˆ°çš„é—®é¢˜

åˆ›å»ºyamlæ–‡ä»¶ï¼Œä½†æ˜¯å›¾æ ‡ä¸æ˜¯å°ç»¿å¶

![1588752434638](SpringBoot.assets/1588752434638.png)



# 5.mybatis

1.åˆ›å»ºé¡¹ç›®ï¼Œå’ŒspringDateä¸€æ ·

2.å¯¼å…¥mybatisæ•´åˆspringbootä¾èµ–

```xml
<!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter -->
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>2.1.1</version>
        </dependency>
```

3.é…ç½®è¿æ¥æ•°æ®åº“ï¼Œæ­¥éª¤åŒspringDate

4.åˆ›å»ºpojoç±»

```java
public class Account {
    private int id;
    private String name;
    private float money;

```

5.åˆ›å»ºä¸šåŠ¡æ¥å£

â€‹	dao.AccountDao

```java
// ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªmybatisçš„mapperç±»
@Mapper
public interface AccountDao {

    List<Account> queryAllAccount();

    int addAccount(Account account);

    int deleteAccount(int id);

    int updateAccount(Account account);
}

```

6.é…ç½®mybatis

 	application.yaml

```yaml

mybatis:
  #åˆ«ååŒ…
  type-aliases-package: com.examle.springbootmybatis.pojo
  #mapperæ‰€åœ¨ä½ç½®
  mapper-locations: classpath:mybatis/mapper/*.xml
```

7.åˆ›å»ºmybatiså®ç°ç±»

â€‹		resource.mybatis.mapper.AccountMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"        		   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--å‘½åç©ºé—´ï¼Œç»‘å®šä¸€ä¸ªå¯¹åº”çš„Daoç±»,ç”¨äºæˆä¸ºå®ƒçš„å®ç°ç±»-->
<mapper namespace="com.example.springbootmybatis.dao">

    <select id="queryAllAccount" resultType="Account">
        select * from account
    </select>

    <insert id="addAccount" parameterMap="Account">
        insert into accout values(#{id},#{name},#{money})
    </insert>

    <delete id="deleteAccount">
        delete from account where id=#{id}
    </delete>

    <update id="updateAccount" parameterMap="Account">
        update account set name=#{name},money=#{money} where id=#{id}
    </update>

</mapper>
```



## é‡åˆ°çš„é—®é¢˜

1.æœªç»‘å®š

â€‹		åŸå› ï¼šxmlå‘½åç©ºé—´æŒ‡å®šçš„æ˜¯åŒ…

â€‹		è§£å†³ï¼šæŒ‡å®šåŒ…çš„æŸä¸ªæ¥å£

â€‹		è§£å†³2ï¼šåœ¨resourcesä¸‹åˆ›å»ºä¸€ä¸ªmapperæ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠxmlæ–‡ä»¶æ”¾è¿›mapperæ–‡ä»¶å¤¹

2.è®¿é—®æ•°æ®åº“å¤±è´¥

![1588833163678](SpringBoot.assets/1588833163678.png)

å°è¯•æ¢ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚æœ¬æ¥ç”¨çš„yamlï¼Œæ¢æˆproperties



# 6.å®‰å…¨

æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨ï¼šåŸç”Ÿä»£ç 

AOPæ€æƒ³ï¼Œæ¨ªåˆ‡è¿›å»ï¼Œä¸ç”¨ä¿®æ”¹åŸæ¥çš„ä»£ç 

## springSecurity

> ä»‹ç»

Spring Securityæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”é«˜åº¦å¯å®šåˆ¶çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶æ¡†æ¶ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¿æŠ¤åŸºäºspringçš„åº”ç”¨ç¨‹åºçš„æ ‡å‡†ã€‚

Spring Securityæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œä¾§é‡äºä¸ºJavaåº”ç”¨ç¨‹åºæä¾›èº«ä»½éªŒè¯å’Œæˆæƒã€‚ä¸æ‰€æœ‰Springé¡¹ç›®ä¸€æ ·ï¼ŒSpringå®‰å…¨æ€§çš„çœŸæ­£å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒå¯ä»¥è½»æ¾åœ°æ‰©å±•ä»¥æ»¡è¶³å®šåˆ¶éœ€æ±‚

> åŠŸèƒ½

Spring Security åŸºäº Spring æ¡†æ¶ï¼Œæä¾›äº†ä¸€å¥— Web åº”ç”¨å®‰å…¨æ€§çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒWeb åº”ç”¨çš„å®‰å…¨æ€§åŒ…æ‹¬**ç”¨æˆ·è®¤è¯ï¼ˆAuthenticationï¼‰**å’Œ**ç”¨æˆ·æˆæƒï¼ˆAuthorizationï¼‰**ä¸¤ä¸ªéƒ¨åˆ†ã€‚ç”¨æˆ·è®¤è¯æŒ‡çš„æ˜¯éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦ä¸ºç³»ç»Ÿä¸­çš„åˆæ³•ä¸»ä½“ï¼Œä¹Ÿå°±æ˜¯è¯´**ç”¨æˆ·èƒ½å¦è®¿é—®è¯¥ç³»ç»Ÿ**ã€‚ç”¨æˆ·è®¤è¯ä¸€èˆ¬è¦æ±‚ç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚ç³»ç»Ÿé€šè¿‡æ ¡éªŒç”¨æˆ·åå’Œå¯†ç æ¥å®Œæˆè®¤è¯è¿‡ç¨‹ã€‚**ç”¨æˆ·æˆæƒæŒ‡çš„æ˜¯éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰§è¡ŒæŸä¸ªæ“ä½œ**ã€‚åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œ**ä¸åŒç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™æ˜¯ä¸åŒçš„**ã€‚æ¯”å¦‚å¯¹ä¸€ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œæœ‰çš„ç”¨æˆ·åªèƒ½è¿›è¡Œè¯»å–ï¼Œè€Œæœ‰çš„ç”¨æˆ·å¯ä»¥è¿›è¡Œä¿®æ”¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç³»ç»Ÿä¼šä¸ºä¸åŒçš„ç”¨æˆ·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œè€Œæ¯ä¸ªè§’è‰²åˆ™å¯¹åº”ä¸€ç³»åˆ—çš„æƒé™ã€‚

å¯¹äºä¸Šé¢æåˆ°çš„ä¸¤ç§åº”ç”¨æƒ…æ™¯ï¼ŒSpring Security æ¡†æ¶éƒ½æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚**åœ¨ç”¨æˆ·è®¤è¯æ–¹é¢ï¼ŒSpring Security æ¡†æ¶æ”¯æŒä¸»æµçš„è®¤è¯æ–¹å¼**ï¼ŒåŒ…æ‹¬ HTTP åŸºæœ¬è®¤è¯ã€HTTP è¡¨å•éªŒè¯ã€HTTP æ‘˜è¦è®¤è¯ã€OpenID å’Œ LDAP ç­‰ã€‚**åœ¨ç”¨æˆ·æˆæƒæ–¹é¢ï¼ŒSpring Security æä¾›äº†åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶å’Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆAccess Control Listï¼ŒACLï¼‰**ï¼Œå¯ä»¥å¯¹åº”ç”¨ä¸­çš„é¢†åŸŸå¯¹è±¡è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ã€‚



### å‰æ

1.åˆ›å»ºé¡¹ç›®ï¼Œé€‰æ‹©webå’Œsql API , MySQL Driver

2.å¯¼å…¥themyleafæ¨¡æ¿

3.åˆ›å»ºé™æ€èµ„æº

4.ç¼–å†™controller

```java
@org.springframework.stereotype.Controller
public class Controller {

    @RequestMapping({"/","/index"})
    public String index(){
        return "index";
    }

    @RequestMapping("/toLogin")
    public String tologin(){
        return "views/login";
    }

//    ç§’å•Šï¼Œæ ¹æ®idè·³è½¬å¯¹åº”çš„ç½‘é¡µ
    @RequestMapping("/level1/{id}")
    public String leavel1(@PathVariable("id") int id){
        return "views/level1/"+id;
    }

    @RequestMapping("/level2/{id}")
    public String leavel2(@PathVariable("id") int id){
        return "views/level2/"+id;
    }

    @RequestMapping("/level3/{id}")
    public String leavel3(@PathVariable("id") int id){
        return "views/level3/"+id;
    }
}
```

5.è¿è¡Œ

![1588840370273](SpringBoot.assets/1588840370273.png)



é‚£ä¹ˆï¼Œæ€ä¹ˆå®ç°ç”¨æˆ·æƒé™ï¼Ÿä½¿ç”¨AOP

### å¼€å§‹é…ç½®

å¼•å…¥spring-boot-starter-securityæ¨¡å—

>  é…ç½®ç±»

- WebSecurityConfigurerAdapter      è‡ªå®šä¹‰Securityç­–ç•¥
- AuthenticationManagerBuilder       è‡ªå®šä¹‰è®¤è¯ç­–ç•¥
- @EnableWebSercurity      å¼€å¯WebSecurityæ¨¡å¼



1.å¯¼åŒ…

```xml
<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>
```

2.åˆ›å»ºé…ç½®ç±»ï¼Œç»§æ‰¿WebSecurityConfigurerAdapter,æ·»åŠ @EnableWebSercurityæ³¨è§£

â€‹		**è®¾ç½®è®¿é—®å†…å®¹éœ€è¦çš„æƒé™**

```java
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
//              é¦–é¡µæ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®ï¼ŒåŠŸèƒ½é¡µåªæœ‰å¯¹åº”çš„æƒé™å¾—äººæ‰èƒ½è®¿é—®
        http.authorizeRequests()
                .antMatchers("/").permitAll()
                .antMatchers("/level1/**").hasRole("vip1")
                .antMatchers("/level2/**").hasRole("vip2")
                .antMatchers("/level3/**").hasRole("vip3");
        
        //        æ²¡æœ‰æƒé™æ˜¾ç¤ºæ‹’ç»è®¿é—®å¾ˆéš¾çœ‹ï¼Œæ‰€ä»¥è·³è½¬åˆ°ç™»å½•é¡µ
        http.formLogin();
    }
}
```

3.å†æ¬¡è®¿é—®

![1588847000934](SpringBoot.assets/1588847000934.png)

4.åŠ å…¥è¯­å¥http.formLogin();**æ²¡æœ‰æƒé™å°±è·³è½¬åˆ°ç™»å½•é¡µ**

**formLoginæºç åˆ†æ**

![1588851630676](SpringBoot.assets/1588851630676.png)

å¯ä»¥å°†securityåˆ›å»ºçš„ç™»å½•é¡µæ›¿æ¢ä¸ºè‡ªå·±ç¼–å†™çš„ç™»å½•é¡µ

```java
//              å®šåˆ¶ç™»å½•é¡µ loginPage
        http.formLogin().loginPage("/toLogin");
```

5.ç”¨æˆ·è®¤è¯æƒé™

â€‹	**åˆ›å»ºå‡ ä¸ªç”¨æˆ·å¹¶ç»™äºˆæƒé™**

```java
//    è®¤è¯    springbootç‰ˆæœ¬2.1.xä»¥ä¸Šå¯ä»¥èƒ½ä¼šæŠ¥é”™ æç¤ºå¯†ç ç¼–ç ä¸ºnull
//    æ·»åŠ å¯†ç ç¼–ç .passwordEncoder
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
//        è¿™äº›æ•°æ®å¯ä»¥ä»æ•°æ®åº“ä¸­è¯»ï¼Œä¹Ÿå¯ä»¥ä»å†…å­˜ä¸­è¯»ï¼Œé€Ÿåº¦è¾ƒå¿«
        auth.inMemoryAuthentication().passwordEncoder(new BCryptPasswordEncoder())
         		.withUser("YY").password(new BCryptPasswordEncoder().encode("123456")).roles("vip1")
                .and().withUser("YZY").password(new BCryptPasswordEncoder().encode("123456")).roles("vip2");
    }
}
```

6.ç™»å½•â€œYYâ€è´¦å·ï¼ˆæƒé™VIP1ï¼‰ï¼Œé€‰æ‹©vip2çš„ç½‘é¡µï¼Œforbiddenè¢«ç¦æ­¢çš„

![1588857719391](SpringBoot.assets/1588857719391.png)

7.**æ³¨é”€**è´¦å·

æ³¨é”€**æºç **

![1588863817786](SpringBoot.assets/1588863817786.png)

åœ¨formLoginåé¢åŠ   http.logout();



8.æƒ³è®©æ‹¥æœ‰æŒ‡å®šæƒé™çš„ç”¨æˆ·ä¸èƒ½çœ‹è§å…¶ä»–**æƒé™çš„å†…å®¹**

 é¦–é¡µ

```html
 <!--å¦‚æœæœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•æŒ‰é’®
                           è®¤å¯ï¼šâ€œæ²¡æœ‰ç™»å½•â€ ï¼Œç„¶åæ˜¾ç¤ºç™»å½•æŒ‰é’®-->
                <div sec:authorize="!isAuthenticated()">
                    <a class="item" th:href="@{/toLogin}">
                        <i class="address card icon"></i> ç™»å½•
                    </a>
                </div>
<!--                å¦‚æœå·²ç™»å½•ï¼Œæ˜¾ç¤ºæ³¨é”€æŒ‰é’®å’Œç”¨æˆ·æƒé™å¯¹åº”çš„nå†…å®¹-->
                <div sec:authorize="isAuthenticated()">

                    <a class="item">
                        ç”¨æˆ·åï¼š <div sec:authentication="name"></div>
                         æƒé™ ï¼š<div sec:authentication="authorities"></div>
                    </a>
                    <a class="item" th:href="@{/logout}">
                        <i class="address card icon"></i> æ³¨é”€
                    </a>
                </div>

<!--        ä¿¡æ¯æ ¹æ®æƒé™æ˜¾ç¤º-->
    <div sec:authorize="hasRole('vip2')" class="column"></div>
		<div class="ui raised segment">
                    <div class="ui">
                        <div class="content">
                            <h5 class="content">Level 2</h5>
                            <hr>
                            <div><a th:href="@{/level2/1}"><i class="bullhorn icon"></i> Level-2-1</a></div>
                            <div><a th:href="@{/level2/2}"><i class="bullhorn icon"></i> Level-2-2</a></div>
                            <div><a th:href="@{/level2/3}"><i class="bullhorn icon"></i> Level-2-3</a></div>
                        </div>
                    </div>
                </div>
            </div>
    <div sec:authorize="hasRole('vip3')" class="column"></div>
```

![1588866287863](SpringBoot.assets/1588866287863.png)

ç™»å½•å

![1588866358883](SpringBoot.assets/1588866358883.png)

![1588866401851](SpringBoot.assets/1588866401851.png)



## shiro

> ä»€ä¹ˆæ˜¯shiro

apach shiroæ˜¯ä¸€ä¸ªJavaçš„å®‰å…¨æ¡†æ¶

å¯ä»¥å®Œæˆè®¤è¯ï¼Œæˆæƒï¼ŒåŠ å¯†ï¼Œä¼šè¯ç®¡ç†ï¼ŒWebé›†æˆï¼Œç¼“å­˜



> åŠŸèƒ½

**Authentication**ï¼šèº«ä»½è®¤è¯/ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯ä¸æ˜¯æ‹¥æœ‰ç›¸åº”çš„èº«ä»½ï¼›
**Authorization**ï¼šæˆæƒï¼Œå³æƒé™éªŒè¯ï¼ŒéªŒè¯æŸä¸ªå·²è®¤è¯çš„ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªæƒé™ï¼›å³åˆ¤æ–­ç”¨
		æˆ·æ˜¯å¦èƒ½åšäº‹æƒ…ï¼Œå¸¸è§çš„å¦‚ï¼šéªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªè§’è‰²ã€‚æˆ–è€…ç»†ç²’åº¦çš„éªŒè¯æŸä¸ªç”¨
		æˆ·å¯¹æŸä¸ªèµ„æºæ˜¯å¦å…·æœ‰æŸä¸ªæƒé™ï¼›
**Session Manager**ï¼šä¼šè¯ç®¡ç†ï¼Œå³ç”¨æˆ·ç™»å½•åå°±æ˜¯ä¸€æ¬¡ä¼šè¯ï¼Œåœ¨æ²¡æœ‰é€€å‡ºä¹‹å‰ï¼Œå®ƒçš„æ‰€æœ‰ä¿¡
		æ¯éƒ½åœ¨ä¼šè¯ä¸­ï¼›ä¼šè¯å¯ä»¥æ˜¯æ™®é€š JavaSE ç¯å¢ƒçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦‚ Web ç¯å¢ƒçš„ï¼›
**Cryptography**ï¼šåŠ å¯†ï¼Œä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ï¼Œå¦‚å¯†ç åŠ å¯†å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè€Œä¸æ˜¯æ˜æ–‡å­˜å‚¨ï¼›
**Web Support**ï¼šWeb æ”¯æŒï¼Œå¯ä»¥éå¸¸å®¹æ˜“çš„é›†æˆåˆ° Web ç¯å¢ƒï¼›
**Caching**ï¼šç¼“å­˜ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•åï¼Œå…¶ç”¨æˆ·ä¿¡æ¯ã€æ‹¥æœ‰çš„è§’è‰²/æƒé™ä¸å¿…æ¯æ¬¡å»æŸ¥ï¼Œè¿™æ ·å¯ä»¥æé«˜æ•ˆç‡ï¼›
**Concurrency**ï¼šshiro æ”¯æŒå¤šçº¿ç¨‹åº”ç”¨çš„å¹¶å‘éªŒè¯ï¼Œå³å¦‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œèƒ½
		æŠŠæƒé™è‡ªåŠ¨ä¼ æ’­è¿‡å»ï¼›
**Testing**ï¼šæä¾›æµ‹è¯•æ”¯æŒï¼›
**Run As**ï¼šå…è®¸ä¸€ä¸ªç”¨æˆ·å‡è£…ä¸ºå¦ä¸€ä¸ªç”¨æˆ·ï¼ˆå¦‚æœä»–ä»¬å…è®¸ï¼‰çš„èº«ä»½è¿›è¡Œè®¿é—®ï¼›
**Remember Me**ï¼šè®°ä½æˆ‘ï¼Œè¿™ä¸ªæ˜¯éå¸¸å¸¸è§çš„åŠŸèƒ½ï¼Œå³ä¸€æ¬¡ç™»å½•åï¼Œä¸‹æ¬¡å†æ¥çš„è¯ä¸ç”¨ç™»å½•
		è®°ä½ä¸€ç‚¹ï¼ŒShiro ä¸ä¼šå»ç»´æŠ¤ç”¨æˆ·ã€ç»´æŠ¤æƒé™ï¼›è¿™äº›éœ€è¦æˆ‘ä»¬è‡ªå·±å»è®¾è®¡/æä¾›ï¼›ç„¶åé€šè¿‡
		ç›¸åº”çš„æ¥å£æ³¨å…¥ç»™ Shiro å³å¯ 



> æ ¸å¿ƒ

 ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](SpringBoot.assets/20181205210949620.png) 

**ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶**ï¼šSubject, SecurityManager å’Œ Realms.

**Subjectä»£è¡¨äº†å½“å‰ç”¨æˆ·çš„å®‰å…¨æ“ä½œï¼ŒSecurityManageråˆ™ç®¡ç†æ‰€æœ‰ç”¨æˆ·çš„å®‰å…¨æ“ä½œã€‚**

**SecurityManagerç®¡ç†æ‰€æœ‰Subject**



- **Subject**ï¼š

  â€‹	å³â€œå½“å‰æ“ä½œç”¨æˆ·â€ã€‚ä½†æ˜¯ï¼Œåœ¨Shiroä¸­ï¼ŒSubjectè¿™ä¸€æ¦‚å¿µå¹¶ä¸ä»…ä»…æŒ‡äººï¼Œä¹Ÿå¯ä»¥æ˜¯ç¬¬ä¸‰æ–¹è¿›ç¨‹ã€åå°å¸æˆ·ï¼ˆDaemon Accountï¼‰æˆ–å…¶ä»–ç±»ä¼¼äº‹ç‰©ã€‚å®ƒä»…ä»…æ„å‘³ç€â€œå½“å‰è·Ÿè½¯ä»¶äº¤äº’çš„ä¸œè¥¿â€ã€‚

- **SecurityManager**ï¼š

  â€‹	å®ƒæ˜¯Shiroæ¡†æ¶çš„==æ ¸å¿ƒ==ï¼Œå…¸å‹çš„Facadeæ¨¡å¼ï¼ŒShiroé€šè¿‡SecurityManageræ¥**ç®¡ç†å†…éƒ¨ç»„ä»¶å®ä¾‹ï¼Œå¹¶é€šè¿‡å®ƒæ¥æä¾›å®‰å…¨ç®¡ç†çš„å„ç§æœåŠ¡**ã€‚

- **Realm**ï¼š

   	Realmå……å½“äº†**Shiroä¸åº”ç”¨å®‰å…¨æ•°æ®é—´çš„â€œæ¡¥æ¢â€æˆ–è€…â€œè¿æ¥å™¨â€**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å¯¹ç”¨æˆ·æ‰§è¡Œè®¤è¯ï¼ˆç™»å½•ï¼‰å’Œæˆæƒï¼ˆè®¿é—®æ§åˆ¶ï¼‰éªŒè¯æ—¶ï¼ŒShiroä¼šä»åº”ç”¨é…ç½®çš„Realmä¸­æŸ¥æ‰¾ç”¨æˆ·åŠå…¶æƒé™ä¿¡æ¯ã€‚ã€€ã€€

  

ã€€>  æ¶æ„

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](SpringBoot.assets/20181205211620525.png)
**Subject**ï¼šä¸»ä½“ï¼Œå¯ä»¥çœ‹åˆ°ä¸»ä½“å¯ä»¥æ˜¯ä»»ä½•å¯ä»¥ä¸åº”ç”¨äº¤äº’çš„â€œç”¨æˆ·â€ï¼›
**SecurityManager** ï¼š ç›¸ å½“ äº SpringMVC ä¸­ çš„ DispatcherServlet ,æ˜¯ Shiro çš„å¿ƒè„ï¼›æ‰€æœ‰å…·ä½“çš„äº¤äº’éƒ½é€šè¿‡ 		SecurityManager è¿›è¡Œæ§åˆ¶ï¼›å®ƒç®¡ç†ç€æ‰€æœ‰ Subjectã€ä¸”è´Ÿè´£è¿›è¡Œè®¤è¯å’Œæˆæƒã€åŠä¼šè¯ã€ç¼“å­˜çš„ç®¡ç†ã€‚
**Authenticator**ï¼šè®¤è¯å™¨ï¼Œè´Ÿè´£ä¸»ä½“è®¤è¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå¦‚æœç”¨æˆ·è§‰å¾— Shiro é»˜è®¤çš„ä¸å¥½ï¼Œå¯ä»¥è‡ªå®šä¹‰å®		ç°ï¼›å…¶éœ€è¦è®¤è¯ç­–ç•¥ï¼ˆAuthentication Strategyï¼‰ï¼Œå³ä»€ä¹ˆæƒ…å†µä¸‹ç®—ç”¨æˆ·è®¤è¯é€šè¿‡äº†ï¼›
**Authrizer**ï¼šæˆæƒå™¨ï¼Œæˆ–è€…è®¿é—®æ§åˆ¶å™¨ï¼Œç”¨æ¥å†³å®šä¸»ä½“æ˜¯å¦æœ‰æƒé™è¿›è¡Œç›¸åº”çš„æ“ä½œï¼›å³æ§åˆ¶ç€ç”¨æˆ·èƒ½è®¿é—®åº”ç”¨ä¸­çš„	å“ªäº›åŠŸèƒ½ï¼›
**Realm**ï¼šå¯ä»¥æœ‰ 1 ä¸ªæˆ–å¤šä¸ª Realmï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å®‰å…¨å®ä½“æ•°æ®æºï¼Œå³ç”¨äºè·å–å®‰å…¨å®ä½“çš„ï¼›å¯ä»¥æ˜¯ JDBC å®ç°ï¼Œ		ä¹Ÿå¯ä»¥æ˜¯ LDAP å®ç°ï¼Œæˆ–è€…å†…å­˜å®ç°ç­‰ç­‰ï¼›ç”±ç”¨æˆ·æä¾›ï¼›æ³¨æ„ï¼šShiroä¸çŸ¥é“ä½ çš„ç”¨æˆ·/æƒé™å­˜å‚¨åœ¨å“ªåŠä»¥ä½•ç§		æ ¼å¼å­˜å‚¨ï¼›æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬åœ¨åº”ç”¨ä¸­éƒ½éœ€è¦å®ç°è‡ªå·±çš„ Realmï¼›
**SessionManager**ï¼šç®¡ç†sessionçš„ç”Ÿå‘½å‘¨æœŸ.è€Œ Shiro å¹¶ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨ Web ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨å¦‚æ™®é€šçš„ JavaSE ç¯å¢ƒã€EJB ç­‰ç¯å¢ƒï¼›æ‰€æœ‰å‘¢ï¼ŒShiro å°±æŠ½è±¡äº†ä¸€ä¸ªè‡ªå·±çš„ Sessionæ¥ç®¡ç†ä¸»ä½“ä¸åº”ç”¨ä¹‹é—´äº¤äº’çš„æ•°æ®ï¼›è¿™æ ·çš„è¯ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ Web ç¯å¢ƒç”¨ï¼Œåˆšå¼€å§‹æ˜¯ä¸€å°Web æœåŠ¡å™¨ï¼›æ¥ç€åˆä¸Šäº†å° EJB æœåŠ¡å™¨ï¼›è¿™æ—¶æƒ³æŠŠä¸¤å°æœåŠ¡å™¨çš„ä¼šè¯æ•°æ®æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œ
		è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å®ç°è‡ªå·±çš„åˆ†å¸ƒå¼ä¼šè¯ï¼ˆå¦‚æŠŠæ•°æ®æ”¾åˆ° Memcached æœåŠ¡å™¨ï¼‰ï¼›
**SessionDAO**ï¼šDAO å¤§å®¶éƒ½ç”¨è¿‡ï¼Œæ•°æ®è®¿é—®å¯¹è±¡ï¼Œç”¨äºä¼šè¯çš„ CRUDï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³æŠŠ Sessionä¿å­˜åˆ°æ•°æ®åº“ï¼Œé‚£		ä¹ˆå¯ä»¥å®ç°è‡ªå·±çš„ SessionDAOï¼Œé€šè¿‡å¦‚ JDBC å†™åˆ°æ•°æ®åº“ï¼›æ¯”å¦‚æƒ³æŠŠSession æ”¾åˆ° Memcached ä¸­ï¼Œå¯ä»¥å®		ç°è‡ªå·±çš„ Memcached SessionDAOï¼›å¦å¤– SessionDAOä¸­å¯ä»¥ä½¿ç”¨ Cache è¿›è¡Œç¼“å­˜ï¼Œä»¥æé«˜æ€§èƒ½ï¼›
**CacheManager**ï¼šç¼“å­˜æ§åˆ¶å™¨ï¼Œæ¥ç®¡ç†å¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ç­‰çš„ç¼“å­˜çš„ï¼›å› ä¸ºè¿™äº›æ•°æ®åŸºæœ¬
		ä¸Šå¾ˆå°‘å»æ”¹å˜ï¼Œæ”¾åˆ°ç¼“å­˜ä¸­åå¯ä»¥æé«˜è®¿é—®çš„æ€§èƒ½
**Cryptography**ï¼šå¯†ç æ¨¡å—ï¼ŒShiro æé«˜äº†ä¸€äº›å¸¸è§çš„åŠ å¯†ç»„ä»¶ç”¨äºå¦‚å¯†ç åŠ å¯† 



### æ­¥éª¤

1.å¯¼å…¥ä¾èµ–

```xml
<!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-core -->
        <dependency>
            <groupId>org.apache.shiro</groupId>
            <artifactId>shiro-core</artifactId>
            <version>1.5.3</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-log4j12 -->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-log4j12</artifactId>
            <version>1.7.30</version>
            <scope>test</scope>
        </dependency>
        <!-- https://mvnrepository.com/artifact/org.slf4j/jcl-over-slf4j -->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>jcl-over-slf4j</artifactId>
            <version>1.7.30</version>
        </dependency>
```

2.ç¼–å†™é…ç½®æ–‡ä»¶

â€‹	shiro.ini

```ini
[users]
# user 'root' with password 'secret' and the 'admin' role
root = secret, admin
# user 'guest' with the password 'guest' and the 'guest' role
guest = guest, guest
# user 'presidentskroob' with password '12345' ("That's the same combination on
# my luggage!!!" ;)), and role 'president'
presidentskroob = 12345, president
# user 'darkhelmet' with password 'ludicrousspeed' and roles 'darklord' and 'schwartz'
darkhelmet = ludicrousspeed, darklord, schwartz
# user 'lonestarr' with password 'vespa' and roles 'goodguy' and 'schwartz'
lonestarr = vespa, goodguy, schwartz

# -----------------------------------------------------------------------------
# Roles with assigned permissions
# -----------------------------------------------------------------------------
[roles]
# 'admin' role has all permissions, indicated by the wildcard '*'
admin = *
# The 'schwartz' role can do anything (*) with any lightsaber:
schwartz = lightsaber:*
# The 'goodguy' role is allowed to 'drive' (action) the winnebago (type) with
# license plate 'eagle5' (instance specific id)
goodguy = winnebago:drive:eagle5
```

3.è¿è¡Œæ–‡ä»¶

```java
public class Quickstart {
    private static final transient Logger log = LoggerFactory.getLogger(Quickstart.class);
    public static void main(String[] args) {
        //      é€šè¿‡è¯»å–inié…ç½®æ–‡ä»¶è¯»å–realms, users, roles and permissions         é€šè¿‡è¯»å–ç±»è·¯å¾„æ ¹ç›®å½•ä¸‹çš„iniåˆ›å»ºä¸€ä¸ªå·¥å‚
        Factory<SecurityManager> factory = new IniSecurityManagerFactory("classpath:shiro.ini");
        SecurityManager securityManager = factory.getInstance();
        // å¯¹äºè¿™ä¸ªç®€å•çš„å¿«é€Ÿå…¥é—¨ç¤ºä¾‹ï¼Œä½¿ç”¨SecurityManagerå¯ä½œä¸ºJVMå•ä¾‹è®¿é—®ã€‚ä½†å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸ä¼šè¿™æ ·åšè€Œä¾èµ–äºå®ƒä»¬çš„å®¹å™¨é…ç½®æˆ–web.xmlæˆ–webapps
        SecurityUtils.setSecurityManager(securityManager);
         /*è¿™æ—¶ï¼Œç¯å¢ƒå·²ç»å»ºç«‹å¥½äº†ï¼Œä¸Šçš„éƒ½æ˜¯æ¨¡æ¿ï¼Œå›ºå®šçš„*/


        /*ä¸‹é¢çš„æ˜¯æ ¸å¿ƒä»£ç */
        // è·å–å½“å‰æ‰§è¡Œçš„ç”¨æˆ·
        Subject currentUser = SecurityUtils.getSubject();
        // é€šè¿‡ç”¨æˆ·è·å–sessionï¼ˆè¿™ä¸ªsessionä¸æ˜¯webçš„ï¼Œè€Œæ˜¯shiroè‡ªèº«çš„ï¼Œä¸éœ€è¦wbï¼‰
        Session session = currentUser.getSession();
        session.setAttribute("someKey", "aValue");
        String value = (String) session.getAttribute("someKey");
        if (value.equals("aValue")) {
            log.info("subject.session---------------------------------------- [" + value + "]");
        }

        // åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦è¢«è®¤è¯     Authenticatedè®¤è¯
        if (!currentUser.isAuthenticated()) {
//            Tokenä»¤ç‰Œ     ç”Ÿæˆä¸€ä¸ªè´¦å·å¯†ç ä»¤ç‰Œ
            UsernamePasswordToken token = new UsernamePasswordToken("lonestarr", "vespa");
            token.setRememberMe(true);
            try {
                currentUser.login(token);     // æ‰§è¡Œç™»å½•æµç¨‹
            } catch (UnknownAccountException uae) {
                log.info("There is no user with username of " + token.getPrincipal());
            } catch (IncorrectCredentialsException ice) {
                log.info("Password for account " + token.getPrincipal() + " was incorrect!");
            } catch (LockedAccountException lae) {
                log.info("The account for username " + token.getPrincipal() + " is locked.  " +
                        "Please contact your administrator to unlock it.");
            }
            // ... catch more exceptions here (maybe custom ones specific to your application?
            catch (AuthenticationException ae) {
                //unexpected condition?  error?
            }
        }

        //say who they are:
        //print their identifying principal (in this case, a username):
        log.info("User [" + currentUser.getPrincipal() + "] logged in successfully.");

        //æµ‹è¯•å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è¯¥æƒé™
        if (currentUser.hasRole("schwartz")) {
            log.info("May the Schwartz be with you!");
        } else {
            log.info("Hello, mere mortal.");
        }

        //ç²—åŒ–çš„æƒé™
        if (currentUser.isPermitted("lightsaber:wield")) {
            log.info("You may use a lightsaber ring.  Use it wisely.");
        } else {
            log.info("Sorry, lightsaber rings are for schwartz masters only.");
        }

        //ç»†åŒ–ï¼ˆå®ä¾‹åŒ–ï¼‰çš„æƒé™:
        if (currentUser.isPermitted("winnebago:drive:eagle5")) {
            log.info("You are permitted to 'drive' the winnebago with license plate (id) 'eagle5'.  " +
                    "Here are the keys - have fun!");
        } else {
            log.info("Sorry, you aren't allowed to drive the 'eagle5' winnebago!");
        }

        //æ³¨é”€
        currentUser.logout();

        System.exit(0);
    }
}

```





### æ•´åˆspringboot

#### å‰æ

åˆ›å»ºé¡µé¢ç”¨äºåŒºåˆ†ç”¨æˆ·æƒé™ï¼ˆAç”¨æˆ·åªèƒ½å»addï¼Œä¸èƒ½å»updateï¼‰

1.åˆ›å»ºæ–°é¡¹ç›®ï¼Œå¯¼å…¥webå’Œthymeleaf 

2.ç¼–å†™é¦–é¡µhtmlï¼Œ**æ”¾åœ¨templatesç›®å½•ä¸‹ï¼**

3.ç¼–å†™add,updateé¡µé¢ï¼Œæ”¾åœ¨templates/userç›®å½•ä¸‹

4.ç¼–å†™controllerè·³è½¬åˆ°é¦–é¡µï¼Œaddï¼Œupdate





#### æ­£å¼

1.å¯¼å…¥shiro-springæ•´åˆåŒ…

```xml
<!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-spring -->
<dependency>
    <groupId>org.apache.shiro</groupId>
    <artifactId>shiro-spring</artifactId>
    <version>1.5.3</version>
</dependency>

```

2.ç¼–å†™é…ç½®ç±»ï¼ˆåŸºæœ¬æ¡†æ¶ï¼‰ï¼Œ

  å…ˆç¼–å†™**realm**çš„ç±»ï¼ˆéœ€è¦è‡ªå®šä¹‰ï¼‰

```java
public class realm extends AuthorizingRealm {

//    æˆæƒ
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
        System.out.println("realmè®¤è¯----------------------AuthorizationInfo");
        return null;
    }

//    è®¤è¯
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {
        System.out.println("realmæˆæƒ----------------------AuthenticationInfo");
        return null;
    }
}
```

â€‹	**shiroConfig**ï¼š ==é¡ºåº==æ˜¯å…ˆrealmï¼Œå†managerï¼Œå†factorybean

```java
@Configuration
public class shiroConfig  {

//   shiroFilterFactoryBan                        è¿™æ˜¯ç¬¬ä¸‰éƒ¨ï¼Œéœ€è¦manageç®¡ç†
    @Bean
    public ShiroFilterFactoryBean bean(@Qualifier("manager") DefaultWebSecurityManager defaultWebSecurityManager){
        ShiroFilterFactoryBean bean = new ShiroFilterFactoryBean();
//        è®¾ç½®å®‰å…¨ç®¡ç†å™¨
        bean.setSecurityManager(defaultWebSecurityManager);
        return bean;
    }

//      DefaultWebSecurityManager               è¿™æ˜¯ç¬¬äºŒéƒ¨ï¼Œå› ä¸ºmanageréœ€è¦realm
    @Bean(name="manager")
    public DefaultWebSecurityManager defaultWebSecurityManager(@Qualifier("realm") realm realm){
        DefaultWebSecurityManager defaultWebSecurityManager = new DefaultWebSecurityManager();
//          å…³è”realm   ,è¿™é‡Œçš„å‚æ•°ä¸èƒ½ç›´æ¥realmï¼ˆï¼‰ï¼Œå› ä¸ºrealmæ˜¯springç®¡ç†çš„ï¼Œæ‰€ä»¥åœ¨æ–¹æ³•çš„å‚æ•°ä¸Šç”¨springå®¹å™¨çš„beanå¯¹è±¡
        defaultWebSecurityManager.setRealm(realm);

        return defaultWebSecurityManager;
    }

//    realm  å¯¹è±¡ï¼Œéœ€è¦è‡ªå®šä¹‰ï¼ˆåˆ›å»ºä¸€ä¸ªrealmç±»ï¼‰   è¿™æ˜¯ç¬¬ä¸€æ­¥ç¬¬ä¸€æ­¥
    @Bean
    public realm realm(){
        return new realm();
    }
}
```

3.å…·ä½“å®ç°ç”¨æˆ·æƒé™

â€‹	**bean**æ–¹æ³•å†…

```java
HashMap<String,String> map = new HashMap<>();
//        è¿™é‡Œçš„èµ„æºå†™çš„æ˜¯è·¯å¾„ï¼ˆcontrolleré‡Œçš„ï¼‰ï¼Œä¸æ˜¯é¡µé¢
        map.put("/toadd","authc");
        map.put("/toupdate","authc");
//          è®¾ç½®è¿‡æ»¤å™¨çš„å†…å®¹ï¼ˆå“ªäº›è·¯å¾„è¦è¢«è¿‡æ»¤åŠå…¶è®¿é—®æƒé™ï¼‰
        bean.setFilterChainDefinitionMap(map);

//        è®¾ç½®è·³è½¬ç™»å½•é¡µé¢ï¼Œå½“è¢«æ‹¦æˆªæ—¶è·³è½¬åˆ°ç™»å½•é¡µé¢
        bean.setLoginUrl("/tologin");
```

4.ç¼–å†™**controllerç™»å½•æ“ä½œ**

```java
@RequestMapping("/login")
    public String login(String username,String password,Model model){
        //        è·å–å½“å‰ç”¨æˆ·
        Subject subject = SecurityUtils.getSubject();
//        å°è£…ç”¨æˆ·çš„ç™»å½•æ•°æ®
        UsernamePasswordToken token = new UsernamePasswordToken(username, password);
        try{
//      æ‰§è¡Œç™»å½•æµç¨‹ï¼ˆæ‰€æœ‰éªŒè¯çš„æ­¥éª¤shiroéƒ½å¸®æˆ‘ä»¬åšäº†ï¼‰,å¦‚æœé”™è¯¯å°±ä¼šæŠ¥å¼‚å¸¸
            subject.login(token);
            return "index";
        }catch (UnknownAccountException e){
            model.addAttribute("msg","ç”¨æˆ·ä¸å­˜åœ¨");
            return "/user/login";
        }catch (IncorrectCredentialsException e){
            model.addAttribute("msg","å¯†ç é”™è¯¯");
            return "/user/login";
        }
    }
```

ç™»å½•ï¼š

![1589018057526](SpringBoot.assets/1589018057526.png)

ç„¶åæŸ¥çœ‹æ§åˆ¶å°ï¼šå‘ç°**æ‰§è¡Œäº†realmçš„æ–¹æ³•**

![1589018099538](SpringBoot.assets/1589018099538.png)

ä¸¤è€…ä¹‹é—´æˆ‘ä»¬å¹¶æ²¡æœ‰åšä»€ä¹ˆè”ç³»ï¼Œä½†æ˜¯shiroå°±å¸®æˆ‘ä»¬è‡ªåŠ¨è¿æ¥èµ·æ¥äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥**åœ¨realmä¸­æ·»åŠ ç™»å½•æ•°æ®**

5.realmç¼–å†™æ•°æ®è·å–å’Œè®¤è¯

```java
//    è®¤è¯
    @Override
    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {
        System.out.println("realmè®¤è¯----------------------AuthenticationInfo");

//      å¯ä»¥ä»æ•°æ®åº“è·å–æ•°æ®  ï¼Œè¿™é‡Œæ‰‹åŠ¨è®¾ç½®æ•°æ®
        String username="YY";
        String pasword = "1";

        UsernamePasswordToken usertoken =  (UsernamePasswordToken)token;
//        è´¦å·è®¤è¯  ï¼Œè®¤è¯å‚æ•°é‡Œçš„tokenæ˜¯å…¨å±€å­˜åœ¨çš„ï¼Œç™»é™†é‚£è¾¹å°è£…å¥½äº†ï¼Œè¿™è¾¹å°±å¯ä»¥ç”¨
        if(!usertoken.getUsername().equals(username)){
//            return null å³æŠ›å‡ºå¼‚å¸¸ï¼Œç”±äºæ˜¯åˆ¤æ–­usernameçš„ï¼Œå¼‚å¸¸å°±æ˜¯ç”¨æˆ·åä¸å­˜åœ¨
            return null;
        }
//        æˆ‘ä»¬ä¸åšå¯†ç è®¤è¯ï¼Œæœ‰å¯èƒ½æ³„æ¼    ã€‚shiroæš—åœ°é‡Œåšå¯†ç è®¤è¯ï¼Œ
        return new SimpleAuthenticationInfo("",pasword,"");
    }
```

ç™»å½•æ—¶ä¼šæ™ºèƒ½åˆ¤æ–­å¼‚å¸¸æƒ…å†µ

6.è®¾ç½®æœªæˆæƒé¡µé¢

```java
//        è®¾ç½®æœªæˆæƒè¯·æ±‚çš„é¡µé¢
        bean.setUnauthorizedUrl("/tounauthorized");
```



#### æ•´åˆmybatis

å‰å‡ éƒ¨æ“ä½œå’Œspringbootæ•´åˆmybatisä¸€æ ·ï¼ˆå¯ä»¥å¤šä¸€æ­¥serviceå±‚ï¼‰

1.åœ¨**realmçš„è®¤è¯**ä¸­æ·»åŠ ==æ•°æ®åº“æ“ä½œ==

```java
//      ä»æ•°æ®åº“è·å–æ•°æ®
        User user = userService.findUserByUsername(usertoken.getUsername());
//        è´¦å·è®¤è¯  ï¼Œè®¤è¯å‚æ•°é‡Œçš„tokenæ˜¯å…¨å±€å­˜åœ¨çš„ï¼Œç™»é™†é‚£è¾¹å°è£…å¥½äº†ï¼Œè¿™è¾¹å°±å¯ä»¥ç”¨
        if(user==null){
            return null;
        }
//        æˆ‘ä»¬ä¸åšå¯†ç è®¤è¯ï¼Œæœ‰å¯èƒ½æ³„æ¼    ã€‚shiroæš—åœ°é‡Œåšå¯†ç è®¤è¯ï¼Œ
        return new SimpleAuthenticationInfo("",user.getPassword(),"");
    }
```

2.ä¸ºå½“å‰ç”¨æˆ·æ·»åŠ ==æƒé™==

ralmeçš„æˆæƒæ–¹æ³•ï¼ˆä¸¤ç§ï¼‰

- ä¸ºæ‰€æœ‰ç”¨æˆ·æˆäºˆè¯¥æƒé™
- é€šè¿‡è®¤è¯ä¸­æ•°æ®åº“æ“ä½œè·å–userå¯¹è±¡çš„æƒé™å¹¶ç»™äºˆå½“å‰ç”¨æˆ·

```java
//    æˆæƒï¼Œç”¨äºæˆæƒè´¦å·
    @Override
    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
//      åªè¦ç»è¿‡è¿™é‡Œå°±ä¼šæˆæƒ
        SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();
//        ä¸ºæ¯ä¸ªç”¨æˆ·æˆäºˆè¯¥æƒé™
//        info.addStringPermission("user:add");

//        è·å–å½“å‰ç™»å½•çš„ç”¨æˆ·
        Subject subject = SecurityUtils.getSubject();
//        ä»ä¸‹é¢çš„å¯†ç è®¤è¯ç¬¬ä¸€ä¸ª useræ‹¿åˆ°  userå¯¹è±¡
        User user = (User)subject.getPrincipal();
//        ä¸ºsubjectè®¾ç½®æ•°æ®åº“userå¯¹è±¡é‡Œçš„æƒé™
        info.addStringPermission(user.getPerms());

        return info;
    }
```

**ç”¨æˆ·ç™»å½•æƒ…å†µ**ï¼š

![1589038999712](SpringBoot.assets/1589038999712.png)

```java
		map.put("/toadd","perms[user:add]");
        map.put("/toupdate","perms[user:update]");
```

é‚£ä¹ˆå½“YYç™»å½•æ—¶ï¼Œåªèƒ½è®¿é—®updateé¡µé¢

â€‹       å½“yzyç™»å½•æ—¶ï¼Œä¸èƒ½è®¿é—®ä»»ä½•ç½‘é¡µ

â€‹		å½“yç™»å½•æ—¶ï¼Œèƒ½è®¿é—®addç½‘é¡µ



#### æ•´åˆthymeleaf

1.å¯¼åŒ…

```xml
<!--thymeleafä¸­ä½¿ç”¨shiro-->
        <dependency>
            <groupId>com.github.theborakompanioni</groupId>
            <artifactId>thymeleaf-extras-shiro</artifactId>
            <version>2.0.0</version>
        </dependency>
```

2.é…ç½®ç±»Configï¼Œæ³¨å†ŒshiroDialect

```java
@Bean(name = "shiroDialect")
    public ShiroDialect shiroDialect(){
        return new ShiroDialect();
    }
```

3.html

```html
<!-- éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºâ€œè®¿å®¢â€ï¼Œå³æœªè®¤è¯ï¼ˆåŒ…å«æœªè®°ä½ï¼‰çš„ç”¨æˆ·ã€‚ -->
<p shiro:guest="">è®¿å®¢

<!-- è®¤è¯é€šè¿‡æˆ–å·²è®°ä½çš„ç”¨æˆ·ã€‚ -->
<p shiro:user="y">
    è®¤è¯é€šè¿‡æ´»ç€å·²è®°ä½ç”¨æˆ·
</p>

<!-- å·²è®¤è¯é€šè¿‡çš„ç”¨æˆ·ã€‚ä¸åŒ…å«å·²è®°ä½çš„ç”¨æˆ·ï¼Œè¿™æ˜¯ä¸useræ ‡ç­¾çš„åŒºåˆ«æ‰€åœ¨ã€‚ -->
<p shiro:authenticated="user">
    Hello, <span shiro:principal=""></span>, å·²é€šè¿‡ç”¨æˆ·çš„ä¿¡æ¯
</p>

<!-- è¾“å‡ºå½“å‰ç”¨æˆ·ä¿¡æ¯ï¼Œé€šå¸¸ä¸ºç™»å½•å¸å·ä¿¡æ¯ã€‚ -->
<p> è¾“å‡ºå½“å‰ç”¨æˆ·ä¿¡æ¯ <shiro:principal/></p>

<!-- æœªè®¤è¯é€šè¿‡ç”¨æˆ·ï¼Œä¸authenticatedæ ‡ç­¾ç›¸å¯¹åº”ã€‚ä¸guestæ ‡ç­¾çš„åŒºåˆ«æ˜¯ï¼Œè¯¥æ ‡ç­¾åŒ…å«å·²è®°ä½ç”¨æˆ·ã€‚ -->
<p shiro:notAuthenticated="">
    æœªè®¤è¯é€šè¿‡ç”¨æˆ·
</p>

<!-- éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦å±äºè¯¥è§’è‰²ã€‚ -->
<a shiro:hasRole="YY" >ä½ æ˜¯å¦å±äºYY</a><!-- æ‹¥æœ‰è¯¥è§’è‰² -->

<!-- ä¸hasRoleæ ‡ç­¾é€»è¾‘ç›¸åï¼Œå½“ç”¨æˆ·ä¸å±äºè¯¥è§’è‰²æ—¶éªŒè¯é€šè¿‡ã€‚ -->
<p shiro:lacksRole="developer"><!-- æ²¡æœ‰è¯¥è§’è‰² -->
    ä½ ä¸æ˜¯YY
</p>

<!-- éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦å±äºä»¥ä¸‹æ‰€æœ‰è§’è‰²ã€‚ -->
<p shiro:hasAllRoles="developer, 2"><!-- è§’è‰²ä¸åˆ¤æ–­ -->
    You are a developer and a admin.
</p>

<!-- éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦å±äºä»¥ä¸‹ä»»æ„ä¸€ä¸ªè§’è‰²ã€‚ -->
<p shiro:hasAnyRoles="admin, vip, developer,1"><!-- è§’è‰²æˆ–åˆ¤æ–­ -->
    You are a admin, vip, or developer.
</p>

<!--éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŒ‡å®šæƒé™ã€‚ -->
<a shiro:hasPermission="user:update" >ä½ æ‹¥æœ‰updateæƒé™</a><!-- æ‹¥æœ‰æƒé™ -->

<!-- ä¸hasPermissionæ ‡ç­¾é€»è¾‘ç›¸åï¼Œå½“å‰ç”¨æˆ·æ²¡æœ‰åˆ¶å®šæƒé™æ—¶ï¼ŒéªŒè¯é€šè¿‡ã€‚ -->
<p shiro:lacksPermission="user:add"><!-- æ²¡æœ‰æƒé™ -->
    ä½ æ²¡æœ‰addæƒé™ï¼Œä½†æ˜¯çœ‹å¾—åˆ°æˆ‘
</p>

<!-- éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰ä»¥ä¸‹æ‰€æœ‰è§’è‰²ã€‚ -->
<p shiro:hasAllPermissions="user:add, user:update"><!-- æƒé™ä¸åˆ¤æ–­ -->
    ä½ æ˜¯updateï¼Œaddæƒé™äººå‘˜
</p>

<!-- éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰ä»¥ä¸‹ä»»æ„ä¸€ä¸ªæƒé™ã€‚ -->
<p shiro:hasAnyPermissions="user:add, user:update"><!-- æƒé™æˆ–åˆ¤æ–­ -->
    ä½ æ˜¯updateæˆ–addæƒé™äººå‘˜
</p>
```





#### æ€»ç»“

shiroçš„æ‰§è¡Œæµç¨‹ï¼š

1.é€šè¿‡**controller**è¯·æ±‚æ—¶ï¼Œä¼šè§¦å‘**realmçš„è®¤è¯æ–¹æ³•AuthenticationInfo**

â€‹			**å…·ä½“æ“ä½œ**ï¼šrealmçš„AuthenticationInfoç”¨äº**éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®**å’Œ**è¯»å–æ•°æ®åº“æ•°æ®**

â€‹				    å¦‚æœé€šè¿‡è®¤è¯ï¼Œæ­¤æ—¶æ•°æ®åº“çš„userå°±ä¼šå˜æˆsubject



2.**realmçš„æˆæƒæ–¹æ³•AuthorizationInfo**ä¼šå¯¹å½“å‰ç”¨æˆ·**Subject**è¿›è¡Œ**æˆæƒ**

â€‹			**å…·ä½“æ“ä½œ**ï¼šrealmdçš„AuthorizationInfoä¼šä»è¯»å–çš„æ•°æ®ä¸º**å½“å‰ç”¨æˆ·æˆæƒï¼ˆaddStringPermissionï¼‰**

â€‹					å°†æ•°æ®åº“çš„userçš„æƒé™èµ‹ç»™subject



3.**DefaultWebSecurityManager**ä¼š**å…³è”realm**å’Œ**ShiroFilterFactoryBean**

â€‹			**å…·ä½“æ“ä½œ**ï¼šsetRealm(realm) ï¼šè·å–realmçš„æ•°æ®



4.**ShiroFilterFactoryBean**è®¾ç½®èµ„æº**æƒé™**ï¼Œè®¾ç½®ç™»å½•å’Œæœªæˆæƒ**è·³è½¬é¡µé¢**

â€‹			**å…·ä½“æ“ä½œ**ï¼š1.setSecurityManager(defaultWebSecurityManager);   é€šè¿‡managerè·å–realmçš„æ•°æ®

â€‹								2.map.put("/toadd","perms[user:add]");     è®¾ç½®èµ„æºçš„æƒé™ï¼Œå¹¶å°†mapæ”¾å…¥è¿‡æ»¤å™¨

â€‹								3. setXXXurl("")    											 è®¾ç½®è·³è½¬é¡µé¢

â€‹					å°†èµ„æºè®¾ç½®å’Œè·å–çš„æ•°æ®è¿›è¡Œå¯¹æ¯”ï¼ŒæˆåŠŸå°±è®¿é—®ï¼Œä¸æˆåŠŸè·³è½¬æœªæˆæƒé¡µé¢

5.controlleræ ¹æ®shiroè¿”å›å¯¹åº”çš„ä¿¡æ¯





# 7.Swagger

> èƒŒæ™¯

**å¤§åç«¯**ï¼šå‰ç«¯åªç®¡ç†é™æ€é¡µé¢htmkï¼Œcssï¼Œåç«¯ä½¿ç”¨æ¨¡æ¿å¼•æ“

**å‰åç«¯åˆ†ç¦»**ï¼š

- **åç«¯**ï¼šåç«¯æ§åˆ¶å™¨ï¼ŒæœåŠ¡å±‚ï¼Œæ•°æ®è®¿é—®å±‚
- **å‰ç«¯**ï¼šå‰ç«¯æ§åˆ¶å±‚ï¼Œè§†å›¾å±‚
  - å‰ç«¯å¯ä»¥é€šè¿‡ä¼ªé€ åç«¯æ•°æ®ï¼Œä¸ä¾é åç«¯ä¹Ÿèƒ½è·‘èµ·æ¥ï¼ˆå‰ç«¯å·¥ç¨‹åŒ–ï¼‰
- å‰åç«¯å¦‚ä½•**äº¤äº’**ï¼šé€šè¿‡æ¥å£ï¼Œä¼ é€’jsonæ•°æ®
- å‰åç«¯ç›¸å¯¹**ç‹¬ç«‹**ï¼Œæ¾è€¦åˆï¼Œå¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Š



äº§ç”Ÿçš„é—®é¢˜ï¼š

- å‰åç«¯æ²Ÿé€šå›°éš¾ï¼Œæ”¹å˜ä¸šåŠ¡éº»çƒ¦

è§£å†³é—®é¢˜

- æŒ‡å®šå®Œå–„çš„schemaï¼Œå®æ—¶æ›´æ–°APIï¼Œé™ä½é›†æˆé£é™©
- å‰ç«¯æµ‹è¯•åç«¯æ¥å£ï¼špostman
- åç«¯æä¾›æ¥å£ï¼Œéœ€è¦å®æ—¶æ›´æ–°æœ€æ–°æ›´æ”¹



## ä¼˜ç‚¹

æ›´å¿«æ·æ›´æ–¹ä¾¿è¿›è¡Œæ¥å£APIçš„å¼€å‘

- æœ€æµè¡Œçš„APIæ¡†æ¶
- æ˜¯Resultfulé£æ ¼çš„API ï¼Œæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆï¼š**APIæ–‡æ¡£ä¸APIå®šä¹‰åŒæ­¥æ›´æ–°**
- å¯ä»¥ç›´æ¥è¿è¡Œï¼Œåœ¨çº¿æµ‹è¯•APIæ¥å£
- æ”¯æŒå¤šç§è¯­è¨€





## é›†åˆæˆspringboot

### å…¥é—¨

1.åˆ›å»ºé¡¹ç›®ï¼Œé€‰æ‹©webï¼Œç„¶åå¯¼åŒ…

```xml
 <!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 -->
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-swagger2</artifactId>
            <version>2.9.2</version>
        </dependency>


        <!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui -->
        <dependency>
            <groupId>io.springfox</groupId>
            <artifactId>springfox-swagger-ui</artifactId>
            <version>2.9.2</version>
        </dependency>
```

2.é…ç½®Swagger

  SwaggerConfig:ä»€ä¹ˆéƒ½æ²¡å†™å°±æ˜¯é»˜è®¤è®¾ç½®

```java
@Configuration
@EnableSwagger2
public class SwaggerConfig {

        
}
```

3.ç¼–å†™controllerå’Œæµ‹è¯•

```java
@RestController
public class Controller {

    @RequestMapping("/hi")
    public String show(){
        return "hi";
    }
}
```

è®¿é—®ç½‘é¡µ http://localhost:8080/swagger-ui.html 

![1589123637598](SpringBoot.assets/1589123637598.png)



### é…ç½®Swagger

Swaggerçš„beanå®ä¾‹Docket

```JAVA
@Configuration
@EnableSwagger2
public class SwaggerConfig {

    @Bean
    public Docket docket(@Qualifier("apiInfo") ApiInfo apiInfo){
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo);
    }

//    è®¾ç½®ä¸€ä¸ªSwagger apiInfo  ,è¦†ç›–äº†é»˜è®¤apiInfo
    @Bean
    public ApiInfo apiInfo(){
//      ä½œè€…ä¿¡æ¯
        Contact contact = new Contact("YZY","http://localhost:8080/swagger-ui.html#/","1061603811@qq.com");

        return new ApiInfo("YZYçš„APIæ–‡æ¡£",
                "æ–‡æ¡£æè¿°",
                "1.1",
                "http://localhost:8080/swagger-ui.html#/", contact,
                "Apache 2.0",
                "http://www.apache.org/licenses/LICENSE-2.0",
                new ArrayList());
    }

}
```

æµ‹è¯•

![1589125939220](SpringBoot.assets/1589125939220.png)