# SpringBoot

>  å­¦ä¹ æµç¨‹

![1588145129189](SpringBoot.assets/1588145129189.png)

> ä»€ä¹ˆäº‹SpringBoot

SpringBootåŸºäºSpringå¼€å‘ï¼Œå¹¶ä¸æ˜¯æ›¿ä»£Springï¼Œè€Œæ˜¯å’ŒSpringç´§å¯†ç»“åˆç”¨äºæå‡Springä½“éªŒã€‚

SpringBoot **çº¦å®šå¤§äºé…ç½®**ï¼Œé»˜è®¤è¿›è¡Œäº†å¾ˆå¤šé…ç½®ï¼Œåªéœ€è¦å¾ˆå°‘çš„é…ç½®å°±å¯ä»¥å¼€å‘ã€‚

> ä¼˜ç‚¹

- Springå¼€å‘æ›´åŠ å…¥é—¨
- å¼€ç®±å³ç”¨ï¼Œç®€åŒ–é…ç½®
- å†…åµŒå®¹å™¨ç®€åŒ–Webé¡¹ç›®
- æ²¡æœ‰XMLé…ç½®å’Œå†—ä½™ä»£ç 



## å¾®æœåŠ¡

> ä»€ä¹ˆæ˜¯å¾®æœåŠ¡

 å¾®æœåŠ¡æ˜¯ä¸€ç§**æ¶æ„é£æ ¼**ã€‚ æ˜¯ä¸€ç§å°†ä¸€ä¸ªå•ä¸€åº”ç”¨ç¨‹åºå¼€å‘ä¸ºä¸€ç»„å°å‹æœåŠ¡çš„æ–¹æ³•ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡é—´é€šä¿¡é‡‡ç”¨è½»é‡çº§é€šä¿¡æœºåˆ¶(é€šå¸¸ç”¨HTTPèµ„æºAPI)ã€‚ 

ä¸šåŠ¡æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„æœåŠ¡ï¼Œå½»åº•å»æ‰è€¦åˆï¼Œæ¯ä¸€ä¸ªå¾®æœåŠ¡æä¾›å•ä¸ªä¸šåŠ¡åŠŸèƒ½ï¼Œä¸€ä¸ªæœåŠ¡åªåšä¸€ä»¶äº‹ã€‚ å°æœåŠ¡ä¹‹é—´ç”¨httpæˆ–RPCæ–¹å¼äº’é€š

> å•ä½“åº”ç”¨æ¡†æ¶

å°±æ˜¯SSMï¼Œå…¨éƒ¨æ”¾åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œæ‰“åŒ…ä¸ºä¸€ä¸ªwaråŒ…ã€‚

**å¥½å¤„**ï¼š

- æ˜“äºå¼€å‘å’Œæµ‹è¯•ï¼Œéƒ¨ç½²ååˆ†æ–¹ä¾¿ã€‚éœ€è¦æ‹“å±•æ—¶ï¼Œå¯ä»¥å¤åˆ¶å¤šä¸ªwaråŒ…åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œåšä¸ªè´Ÿè½½å‡è¡¡

**åå¤„**ï¼š

- æˆ‘è¦ä¿®æ”¹ä¸€ä¸ªå°å°çš„åœ°æ–¹ä¹Ÿè¦åœæ‰æ‰€æœ‰æœåŠ¡ï¼Œé‡æ–°æ‰“åŒ…æˆä¸€ä¸ªwaråŒ…

> å¾®æœåŠ¡æ¶æ„

æŠŠåŠŸèƒ½ç‹¬ç«‹å‡ºæ¥ï¼Œä¸šåŠ¡ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½ç»„æˆã€‚ä¸»è¦å¤šä¸ªä¸šåŠ¡å°±èµ‹å€¼å¤šä¸ªåŠŸèƒ½è€Œä¸æ˜¯waråŒ…

**å¥½å¤„**ï¼š

- èŠ‚çœäº†èµ„æºï¼Œå‡å°‘ä»£ç å†—ä½™
- æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¾¿äºç»´æŠ¤

ä½†æ˜¯ï¼Œè¿™ç§åºå¤§çš„ç³»ç»Ÿæ¶æ„ç»™éƒ¨ç½²å’Œè¿ç»´å¸¦æ¥äº†å¾ˆå¤§éš¾åº¦ã€‚ï¼ŒSpringç»™äº†ä¸€å¥—å®Œæ•´çš„å¾®æœåŠ¡ï¼š

- æ„å»ºç‹¬ç«‹åŠŸèƒ½ç”¨**SpringBoot** å¿«é€Ÿæ„å»º
- å¤§å‹**åˆ†å¸ƒå¼ç½‘è·¯æœåŠ¡**çš„è°ƒç”¨ä½¿ç”¨**Spring cloud** æ¥å®ç°åˆ†å¸ƒå¼
- **ä¸­é—´ä»¶**æœ‰**spring cloud data flow**
- 

  http://blog.cuicc.com/blog/2015/07/22/microservices/# ![img](SpringBoot.assets/sketch.png)  

# ç¬¬ä¸€ä¸ªspringbooté¡¹ç›®

![1588213837946](SpringBoot.assets/1588213837946.png)

**é€‰æ‹©web**

![1588213859198](SpringBoot.assets/1588213859198.png)

**å®Œæˆï¼**

![1588213890998](SpringBoot.assets/1588213890998.png)



> å»ºåŒ…è¦åœ¨ä¸»ç¨‹åºçš„åŒçº§ç›®å½•ä¸‹

![1588213967068](SpringBoot.assets/1588213967068.png)

> controller

```java
@RestController
public class Contreoller {

    @RequestMapping("/YY")
    public String data(){

        return "YY";
    }
}
```

> è¿è¡Œæ•ˆæœ

![1588214765411](SpringBoot.assets/1588214765411.png)

> æ›´æ”¹é¡¹ç›®ç«¯å£å·

![](SpringBoot.assets/QQå›¾ç‰‡20200430110530.png)

> banner

èµ„æºç›®å½•ä¸‹åˆ›å»ºbanner.txt



## æ‰“åŒ…

> package

![1588214808366](SpringBoot.assets/1588214808366.png)

> ä½ç½®

åœ¨targetç›®å½•ä¸‹

![1588214848702](SpringBoot.assets/1588214848702.png)

> powershell

åœ¨jarçš„ç›®å½•ä¸‹ï¼Œ**æŒ‰ä½shiftå’Œå³é”®**ï¼Œæ‰“å¼€powershellçª—å£

è¾“å…¥java -jar .\é¡¹ç›®å

![1588215197111](SpringBoot.assets/1588215197111.png)

æœåŠ¡å¯åŠ¨äº†,å…³é—­ideaçš„tomcatï¼Œå†æ¬¡æ‰“å¼€ http://localhost:8080/YY ï¼Œè¿˜æ˜¯èƒ½è®¿é—®ï¼

å…³é—­powershellçª—å£åå°±æ— æ³•è®¿é—®äº†

> å¾®æœåŠ¡

è¿™å°±æ˜¯å¾®æœåŠ¡ï¼ŒæŠŠæœåŠ¡å˜æˆä¸€ä¸ªä¸ªå—ï¼Œä¸ä¾èµ–ideaä¹Ÿèƒ½æ‰“å¼€ï¼Œå†…ç½®äº†tomcat



# 

# 1.è‡ªåŠ¨è£…é…

## ä¾èµ–

#### pom.xml

pom.xmlçš„**çˆ¶ç±»** spring-boot-starter-parent



> å¯åŠ¨å™¨
>
> > spring-boot-starter-XXX:ä»dependenciesä¸­è‡ªåŠ¨å¯¼å…¥ç¯å¢ƒä¾èµ–

**ä¾‹å¦‚**-webï¼š**è‡ªåŠ¨å¯¼å…¥webç¯å¢ƒçš„æ‰€æœ‰ä¾èµ–**

ç‚¹å‡»å»å°±èƒ½å‘ç°**å¾ˆå¤šä¾èµ–åŒ…**ï¼šspring-webï¼Œspring-webmvcï¼Œtomcatï¼Œjson

```xml
 <dependency>
<!--          å¯åŠ¨å™¨ï¼Œwebè¿™ä¸ªä¾èµ–åŒ…å«äº†SpringMvc,è‡ªåŠ¨è£…é…ï¼Œä½¿ç”¨tomcatä¸ºé»˜è®¤å®¹å™¨-->
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
```





####  spring-boot-starter-parent

>  èµ„æºè¿‡æ»¤,mavenæ’ä»¶

```
<resources>
      <resource>
        <filtering>true</filtering>
        <directory>${basedir}/src/main/resources</directory>
        <includes>
          <include>**/application*.yml</include>
          <include>**/application*.yaml</include>
          <include>**/application*.properties</include>
        </includes>
      </resource>
      <resource>
        <directory>${basedir}/src/main/resources</directory>
        <excludes>
          <exclude>**/application*.yml</exclude>
          <exclude>**/application*.yaml</exclude>
          <exclude>**/application*.properties</exclude>
        </excludes>
      </resource>
    </resources>
```

#### dependenices

>æ‰€æœ‰åŠŸèƒ½åœºæ™¯å˜æˆå¯åŠ¨å™¨

spring-boot-dependencies åŒ…ä¸‹ï¼Œå·²ç»æŒ‡å®šå¥½äº†é‚£ä¸ªç‰ˆæœ¬ï¼Œä¾èµ–æ—¶å°±ä¸éœ€è¦æŒ‡å®šäº†

![1588217280640](SpringBoot.assets/1588217280640.png)

è¿™äº›å°±æ˜¯**å¯åŠ¨å™¨**

å¦‚æœä½ æƒ³ç”¨å“ªä¸ªç¯å¢ƒï¼Œå°±å¯ç”¨å¯¹åº”çš„å¯åŠ¨å™¨å°±è¡Œäº†

> è‡ªå¸¦ä¾èµ–

![1588314202626](SpringBoot.assets/1588314202626.png)

pom.xmlçš„webåŒ…å°±æ˜¯ä»dependenciesä¸­å–å‡ºæ¥



## ä¸»ç¨‹åº

```java
//è¿™ä¸ªç±»å°±æ˜¯ä¸€ä¸ªComponent
@SpringBootApplication
//@SpringBootApplicationæ ‡å¿—è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªspringbootçš„åº”ç”¨
public class DemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

}
```



### æ³¨è§£



#### @ä¸»é…ç½®ç±»ï¼šspringBootApplicationï¼š

==ä½œç”¨==ï¼šå°†è¯¥åŒ…åŠå…¶æ‰€æœ‰å­åŒ…çº³å…¥springå®¹å™¨,**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦å°†ä¸šåŠ¡æ”¾åˆ°ä¸»ç¨‹åºåŒçº§ç›®å½•ä¸‹çš„åŸå› **

```java
//å…ƒæ³¨è§£ï¼Œç”¨æ¥ä¿®é¥°å½“å‰æ³¨è§£ï¼Œå°±åƒpublicç±»çš„ä¿®é¥°è¯ï¼Œæ— å®é™…åŠŸèƒ½
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
// springbootçš„é…ç½®ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ç±»ï¼Œå®ƒä¼šè¢«@ComponentScanæ‰«æåˆ°
@SpringBootConfiguration
// å¼€å¯è‡ªåŠ¨è£…é…
@EnableAutoConfiguration
//æ‰«æåŒ…ï¼ˆfiltersè¿‡æ»¤ä¸€äº›ä¸œè¥¿ï¼‰
@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })
public @interface SpringBootApplication {
```



##### @SpringBootConfigurationï¼šä¸»ç¨‹åºä¸ºé…ç½®ç±»

```
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
// é…ç½®ç±»
@Configuration
public @interface SpringBootConfiguration {
```







#### @EnableAutoConfiguration

==ä½œç”¨==ï¼šè‡ªåŠ¨æ³¨å†ŒåŒ…å’Œå¼•å…¥éœ€è¦çš„ç¬¬ä¸‰æ–¹jaråŒ…

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
//è·å–æ‰€åœ¨åŒ…è¿›è¡Œæ³¨å†Œ
@AutoConfigurationPackage
// å°†ç¬¬ä¸‰æ–¹jarå¼•å…¥
@Import(AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {
```



##### @AutoConfigurationPackageï¼šæ‰€åœ¨åŒ…æ³¨å†Œ

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
// å¯¹æºæ•°æ®æ‰€åœ¨åŒ…ä¸‹ç»„ä»¶è¿›è¡Œæ³¨å†Œ
@Import(AutoConfigurationPackages.Registrar.class)
public @interface AutoConfigurationPackage {
```



###### @AutoConfigurationPackages.Registrar

==ä½œç”¨==ï¼šæ‰“åŒ…æºæ•°æ®è·å–åŒ…åè°ƒç”¨registeræ³¨å†Œ

**register**æ–¹æ³•ï¼š æ³¨å†ŒåŒ…

```java
static class Registrar implements ImportBeanDefinitionRegistrar, DeterminableImports {

		@Override
		public void registerBeanDefinitions(AnnotationMetadata metadata, BeanDefinitionRegistry registry) {
            // 	new PackageImport(metadata).getPackageName())å°†æºæ•°æ®æ‰“åŒ…ï¼Œå¹¶è·å¾—å…¶åŒ…å
			register(registry, new PackageImport(metadata).getPackageName());
		}

		@Override
		public Set<Object> determineImports(AnnotationMetadata metadata) {
			return Collections.singleton(new PackageImport(metadata));
		}

	}
```

**åŒ…å**å°±æ˜¯è¿™ä¸ªï¼Œä¸»ç¨‹åºæ‰€åœ¨çš„åŒ…

![1588322355314](SpringBoot.assets/1588322355314.png)

##### @Importï¼šä¸‰æ–¹jaråŒ…

List<String> configurations = getCandidateConfigurations(annotationMetadata, attributes);

è¿›å…¥getCandidateConfigurations

> getCandidateConfigurations:

```java
protected List<String> getCandidateConfigurations(AnnotationMetadata metadata, AnnotationAttributes attributes) {
    //  è¿™è¾¹è·å–æ‰€æœ‰é…ç½®  getSpringFactoriesLoaderFactoryClass()æ–¹æ³•å°±åœ¨ä¸‹é¢
		List<String> configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),
				getBeanClassLoader());
    //  å¦‚æœä¸ºç©ºï¼Œè¾“å‡ºè¯­å¥ï¼ŒMETA-INF/spring.factories
		Assert.notEmpty(configurations, "No auto configuration classes found in META-INF/spring.factories. If you "
				+ "are using a custom packaging, make sure that file is correct.");
		return configurations;
	}

//   EnableAutoConfigurationè¿”å›çš„å°±æ˜¯ä¸»ç¨‹åºçš„åŒ…ï¼Œæ‰€ä»¥è·å–çš„æ˜¯springbootçš„æ‰€æœ‰é…ç½®
	protected Class<?> getSpringFactoriesLoaderFactoryClass() {
		return EnableAutoConfiguration.class;
	}

```

###### loadFactoryNames

![](SpringBoot.assets/QQå›¾ç‰‡20200501175429.png)

> spring.factories

æ‰€åœ¨åœ°å€ï¼š

![1588255539786](SpringBoot.assets/1588255539786.png)

é‡Œé¢å‚¨å­˜çš„éƒ½æ˜¯é…ç½®ç±»çš„è·¯å¾„ï¼Œå½“ä½ éœ€è¦ç”¨æ—¶ï¼Œå°±ä¼šé€šè¿‡è·¯å¾„è°ƒç”¨é…ç½®ç±»ï¼ˆæ¯”å¦‚è§†å›¾è§£æå™¨ï¼‰

> 

#### å¯¼å›¾

![1588328045273](SpringBoot.assets/1588328045273.png)

---



### ä¸»å¯åŠ¨ç¨‹åº

#### springApplication

**è¿™ä¸ªç±»ä¸»è¦åšäº†ä»¥ä¸‹å››ä»¶äº‹æƒ…ï¼š**

1ã€æ¨æ–­åº”ç”¨çš„ç±»å‹æ˜¯æ™®é€šçš„é¡¹ç›®è¿˜æ˜¯Webé¡¹ç›®

2ã€æŸ¥æ‰¾å¹¶åŠ è½½æ‰€æœ‰å¯ç”¨åˆå§‹åŒ–å™¨ ï¼Œ è®¾ç½®åˆ°initializerså±æ€§ä¸­

3ã€æ‰¾å‡ºæ‰€æœ‰çš„åº”ç”¨ç¨‹åºç›‘å¬å™¨ï¼Œè®¾ç½®åˆ°listenerså±æ€§ä¸­

4ã€æ¨æ–­å¹¶è®¾ç½®mainæ–¹æ³•çš„å®šä¹‰ç±»ï¼Œæ‰¾åˆ°è¿è¡Œçš„ä¸»ç±»

æŸ¥çœ‹æ„é€ å™¨ï¼š

```java
public SpringApplication(ResourceLoader resourceLoader, Class<?>... primarySources) {
    
    //	 åŠ è½½èµ„æº
		this.resourceLoader = resourceLoader;
    //  primarySourceä¸èƒ½ä¸ºç©º
		Assert.notNull(primarySources, "PrimarySources must not be null");
    //  éå†primartSource
		this.primarySources = new LinkedHashSet<>(Arrays.asList(primarySources));
    //   æ¨æµ‹webåº”ç”¨ç±»å‹ï¼Œå¹¶èµ‹å€¼åˆ°å±æ€§webApplicationType
		this.webApplicationType = WebApplicationType.deduceFromClasspath();
    //   ç›‘å¬åˆå§‹åŒ–
		setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));
		setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));
		this.mainApplicationClass = deduceMainApplicationClass();
	}
```

---



#### run æµç¨‹

![1588311036777](SpringBoot.assets/1588311036777.png)

==å›¾ç‰‡å¯¹åº”çš„ä»£ç ==

```java
public ConfigurableApplicationContext run(String... args) {
       // è®¡æ—¶å™¨
        StopWatch stopWatch = new StopWatch();
        //  è®¡æ—¶å™¨å¯åŠ¨
        stopWatch.start();
//        åˆå§‹åŒ–ä¸Šä¸‹æ–‡ï¼Œå¼‚å¸¸æŠ¥å‘Šé›†åˆ
        ConfigurableApplicationContext context = null;
        Collection<SpringBootExceptionReporter> exceptionReporters = new ArrayList<>();
//        strep1 ç³»ç»Ÿå±æ€§è®¾ç½®
        configureHeadlessProperty();
        //  step2 åˆ›å»ºæ‰€æœ‰springç›‘å¬å™¨ï¼Œåº•å±‚é‡‡ç”¨factoriesInstancesï¼Œé€šè¿‡ç±»åŠ è½½å™¨è·å–spring.factoriesæ–‡ä»¶ï¼Œè¿›è€Œåå°„å¾—åˆ°classå¯¹è±¡
        SpringApplicationRunListeners listeners = getRunListeners(args);
//        å¯åŠ¨æ‰€æœ‰ç›‘å¬å™¨
        listeners.starting();
        try {
//            step4  è£…é…ç¯å¢ƒå‚æ•°ï¼ˆå¦‚service.port=8082ï¼‰
            ApplicationArguments applicationArguments = new DefaultApplicationArguments(args);
//             ç”¨ç›‘å¬å™¨å’Œç¯å¢ƒå‚æ•°åˆ›å»ºé…ç½®ç¯å¢ƒ
            ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);
            configureIgnoreBeanInfo(environment);
//            step5 æ‰“å°bannerå’Œç¯å¢ƒ
            Banner printedBanner = printBanner(environment);
//            step 6åˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡
            context = createApplicationContext();
//            å¼‚å¸¸æŠ¥å‘Š
            exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,
                    new Class[] { ConfigurableApplicationContext.class }, context);
//            åº”ç”¨ä¸Šä¸‹æ–‡å‡†å¤‡å®Œæ¯•
            prepareContext(context, environment, listeners, applicationArguments, printedBanner);
//            step9 ä¸Šä¸‹æ–‡åˆ·æ–°ï¼šbeanå·¥å‚åŠ è½½ï¼Œé€šè¿‡å·¥å‚ç”Ÿäº§Beanï¼Œåˆ·æ–°ç”Ÿå‘½å‘¨æœŸ
            refreshContext(context);
//              ä¸Šä¸‹æ–‡åç½®ç»“æŸå¤„ç†ï¼ˆä¸Šä¸‹æ–‡å’Œç¯å¢ƒå‚æ•°ï¼‰
            afterRefresh(context, applicationArguments);
//            è®¡æ—¶å™¨ç»“æŸ
            stopWatch.stop();
            if (this.logStartupInfo) {
                new StartupInfoLogger(this.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);
            }
//            ä¸Šä¸‹æ–‡çš„ç›‘å¬å®Œæˆ
            listeners.started(context);
//             step12 æ‰§è¡Œæ‰€æœ‰runnerè¿è¡Œå™¨
            callRunners(context, applicationArguments);
        }catch (Throwable ex) {
            handleRunFailure(context, ex, exceptionReporters, listeners);
            throw new IllegalStateException(ex);
        }

        try {
//          step13 å‘å¸ƒåº”ç”¨ä¸Šä¸‹æ–‡
            listeners.running(context);
        }
        catch (Throwable ex) {
            handleRunFailure(context, ex, exceptionReporters, null);
            throw new IllegalStateException(ex);
        }
//        step13 å°±ç»ªå¹¶è¿”å›
        return context;
    }
```



# 2.é…ç½®æ–‡ä»¶

springBootçš„é…ç½®æ–‡ä»¶æœ‰ä¸¤ç§

![1588341092753](SpringBoot.assets/1588341092753.png)

## properties

è¯­æ³•ç»“æ„   key = value

```properties
service.port = 8081
```

å¦‚æœä½¿ç”¨propertieså’Œç±»ç»‘å®š

```java
// åŠ è½½æŒ‡å®šé…ç½®æ–‡ä»¶
@PropertySource(value = "classpath:student.properties")
public class Student {

//    ä½¿ç”¨propertiesæ–‡ä»¶è®¾ç½®å±æ€§
    @Value("${student.name}")
     private String name;
```



## yaml

>  è¯­æ³•ç»“æ„  : key : ç©ºæ ¼ value

ç©ºæ ¼çš„è¦æ±‚éå¸¸ä¸¥æ ¼ï¼Œ**å‚ç›´å¯¹é½**ï¼Œå±æ€§éœ€è¦**ç¼©è¿›**

```yml
service:
   port: 8081
```

>  å¯¹è±¡

```yaml
student:
  name: YY
  age: 22
  
#è¡Œå†…å†™æ³•
student1: {name: YY,age: 22}
```

> æ•°ç»„

```
#æ•°ç»„
pets:
  - cat
  - dog
  - pig

pets1: [cat,dog,pig]
```

### å±æ€§èµ‹å€¼

 pojo

```java
//å‰æï¼Œè¿™ä¸ªç±»æ˜¯ç»„ä»¶
@Component
//å°†é…ç½®æ–‡ä»¶çš„æ¯ä¸€ä¸ªå±æ€§æ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­ï¼Œå°†æœ¬ç±»çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­çš„ç›¸å…³é…ç½®ï¼ˆstudentä¸‹çš„æ‰€æœ‰å±æ€§ï¼‰å¯¹åº”ç»‘å®š
@ConfigurationProperties(prefix = "student")
public class Student {
    private String name;
    private int age;
```

test

```java
@SpringBootTest
class DemoApplicationTests {
    @Autowired
    Student student;

    @Test
    void contextLoads() {
        System.out.println(student.getAge());
    }

}
```



### æ¾æ•£ç»‘å®š

æ•°æ®åº“å­—æ®µålast-name  å¯ä»¥å’Œ é©¼å³°å‘½åæ³•lastName è‡ªåŠ¨ç»‘å®š

```
private String LastName;
```



### JSR303æ•°æ®æ ¡éªŒ

**éœ€è¦å…ˆå¼€å¯@validateæ•°æ®æ ¡éªŒ**

![1588342848385](SpringBoot.assets/1588342848385.png)



```
//æ•°æ®æ ¡éªŒ
@Validated
public class Student {

    @Email(message = "ğŸ“ªerror")
    private String name;
```



## å¤šç¯å¢ƒé…

### ä¼˜å…ˆçº§

![1588344302070](SpringBoot.assets/1588344302070.png)

### æŒ‡å®šç¯å¢ƒ

> å¤šæ–‡ä»¶

![1588344991080](SpringBoot.assets/1588344991080.png)

```properties
#springbootçš„å¤šç¯å¢ƒé…ç½®ï¼Œå¯ä»¥é€‰æ‹©æ¿€æ´»å“ªä¸€ä¸ª
spring.profiles.active=work
```

> å•æ–‡ä»¶

```yaml
#springbootçš„å¤šç¯å¢ƒé…ç½®ï¼Œå¯ä»¥é€‰æ‹©æ¿€æ´»å“ªä¸€ä¸ª
spring:
  profiles:
    active: test
#ä½¿ç”¨---åˆ†å‰²
---
server:
  port: 8083
spring:
  profiles: test

---
server:
  port: 8082
spring:
  profiles: work
---
server:
  port: 8084
spring:
  profiles: up

```



## é”™è¯¯

1. æŠŠserver å†™æˆservice å¯¼è‡´ç«¯å£ä¿®æ”¹æ²¡æœ‰ç”Ÿæ•ˆ
2. å•æ–‡ä»¶é…ç½®å¤šç¯å¢ƒæ—¶ï¼Œæ–‡ä»¶åå¿…é¡»æ˜¯



## é…ç½®ç±»

**è‡ªåŠ¨é…ç½®ç±»**ä¸ºXXXAutoConfiguration

**é…ç½®ç±»å**ä¸ºXXProperties

> EnableConfigurationProperties

==ä½œç”¨==ï¼š**è‡ªåŠ¨é…ç½®ç±»**ä¼šå°†**é…ç½®ç±»**æ‰€åœ¨çš„åŒ…æ³¨å†Œï¼Œå¹¶è®¾é»˜è®¤å€¼

![1588346645924](SpringBoot.assets/1588346645924.png)



> ConfigurationProperties

**é…ç½®ç±»**å’Œé…ç½®æ–‡ä»¶ç»‘å®š

![1588347315440](SpringBoot.assets/1588347315440.png)

> å¼•å…¥é…ç½®ç±»çš„æ¡ä»¶

å½“æ‰€æœ‰æ¡ä»¶æˆç«‹ï¼Œ**è‡ªåŠ¨é…ç½®ç±»**æ‰ä¼š**ç”Ÿæ•ˆ**ï¼Œæ‰èƒ½å°†é…ç½®ç±»**æ³¨å†Œ**è¿›IOCå®¹å™¨

![](SpringBoot.assets/QQå›¾ç‰‡20200501201143.png)



> æ‰‹åŠ¨é…ç½®å‚æ•°

![1588335522544](SpringBoot.assets/1588335522544.png)

![1588335764204](SpringBoot.assets/1588335764204.png)

prefixå¯¹åº”çš„å°±æ˜¯é…ç½®ç±»åï¼Œç„¶åè®¾ç½®å®ƒçš„å±æ€§

```properties
#è®¾ç½®é…ç½®ç±»çš„å±æ€§,é…ç½®ç±»çš„Configurationå’Œé…ç½®æ–‡ä»¶ç»‘å®šï¼Œé‚£ä¹ˆprefixå¯¹åº”çš„å°±æ˜¯ç±»åï¼Œå°±å¯ä»¥è®¾ç½®ç±»åçš„å±æ€§
spring.data.web.page = 10
```



### æŸ¥çœ‹ç”Ÿæ•ˆçš„é…ç½®ç±»

```yaml
debug: true
```

positive matchï¼šæ˜¾ç¤ºç”Ÿæ•ˆçš„é…ç½®ç±»

nagative matchï¼šæ˜¾ç¤ºæœªç”Ÿæ•ˆçš„é…ç½®ç±»



# 3.Webå¼€å‘

éœ€è¦è§£å†³çš„é—®é¢˜

- å¯¼å…¥é™æ€èµ„æº
- é¦–é¡µ
- jspï¼Œæ¨¡æ¿å¼•æ“thymeleaf
- è£…é…æ‰©å±•springMVC
- ä¸šåŠ¡
- æ‹¦æˆªå™¨
- å›½é™…åŒ–



## å¯¼å…¥é™æ€èµ„æº

>  WebMVCConfiguration.class

æ‰¾åˆ°addResourceHandleræ–¹æ³•

```java
@Override
		public void addResourceHandlers(ResourceHandlerRegistry registry) {
            //åˆ¤æ–­é™æ€èµ„æºæ˜¯å¦å·²è‡ªåŠ¨é…ç½®
			if (!this.resourceProperties.isAddMappings()) {
				logger.debug("Default resource handling disabled");
				return;
			}
			Duration cachePeriod = this.resourceProperties.getCache().getPeriod();
			CacheControl cacheControl = this.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();
            // åˆ¤æ–­èµ„æºæ˜¯å¦é…ç½®åˆ°ä¸€ä¸‹è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè®¾ç½®åˆ°è¯¥è·¯å¾„
			if (!registry.hasMappingForPattern("/webjars/**")) {
		customizeResourceHandlerRegistration(registry.addResourceHandler("/webjars/**")
						.addResourceLocations("classpath:/META-INF/resources/webjars/")
						.setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));
			}
            //  è·å–é™æ€èµ„æºçš„è·¯å¾„ 
			String staticPathPattern = this.mvcProperties.getStaticPathPattern();
			if (!registry.hasMappingForPattern(staticPathPattern)) {
				customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)
						.addResourceLocations(getResourceLocations(this.resourceProperties.getStaticLocations()))
						.setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));
			}
		}
```

1. è®¿é—®webjarç›®å½•ï¼Œé€šè¿‡mavenå¼•å…¥çš„jaråŒ…éƒ½æ˜¯è¿™ç§æ–¹å¼

```java
/webjars/å°±æ˜¯ä¸‹é¢çš„ç¼©å†™
classpath:/META-INF/resources/webjars/
```

![1588406376314](SpringBoot.assets/1588406376314.png)

2. è·å–é¡¹ç›®**é™æ€èµ„æºè·¯å¾„** 

   **this.mvcProperties.getStaticPathPattern();**

```java

String staticPathPattern = this.mvcProperties.getStaticPathPattern();
//è¿™å¥è¯åœ¨ç‚¹è¿›getStaticPathPattern();æ–¹æ³•å
// /** å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½è¯†åˆ«ï¼Œå³èµ„æºç›®å½•
private String staticPathPattern = "/**";
// è¢«è¯†åˆ«çš„ç›®å½•ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ä¸Šé¢é‚£ä¸ªjaræŠ¥çš„
private static final String[] CLASSPATH_RESOURCE_LOCATIONS = { 
  "classpath:/META-INF/resources/"  , "classpath:/resources/", 
    "classpath:/static/",   "classpath:/public/" };
```

å‰©ä¸‹ä¸‰ä¸ªï¼šå¯¹åº”èµ„æºç›®å½•ä¸‹çš„ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼ˆå¯æ‰‹åŠ¨åˆ›å»ºï¼‰

![1588407745214](SpringBoot.assets/1588407745214.png)

### æ€»ç»“

é€šè¿‡æºç ï¼Œæˆ‘ä»¬çŸ¥é“4ç§æ–¹å¼å¤„ç†é™æ€èµ„æº

- webjar ç¬¬ä¸‰å‘jaråŒ…			è®¿é—®è·¯å¾„ï¼šlocalhost:8080/webjar/æ–‡ä»¶å
- public,static,resources  ä¸‰ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶    è®¿é—®è·¯å¾„ï¼šlovalhost:8080/æ–‡ä»¶å

ä¼˜å…ˆçº§ï¼šresource > static(é»˜è®¤) > public 









## æ¨¡æ¿å¼•æ“

> ä»€ä¹ˆæ˜¯æ¨¡æ¿å¼•æ“

 æ˜¯ä¸ºäº†ä½¿ç”¨æˆ·ç•Œé¢ä¸ä¸šåŠ¡æ•°æ®ï¼ˆå†…å®¹ï¼‰åˆ†ç¦»è€Œäº§ç”Ÿçš„ï¼Œå®ƒå¯ä»¥ç”Ÿæˆç‰¹å®šæ ¼å¼çš„æ–‡æ¡£ï¼Œç”¨äºç½‘ç«™çš„æ¨¡æ¿å¼•æ“å°±ä¼šç”Ÿæˆä¸€ä¸ªæ ‡å‡†çš„[HTML](https://baike.baidu.com/item/HTML/97049)æ–‡æ¡£ ï¼Œæ¯”å¦‚JSPå°±æ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ã€‚

**æœ‰æ—¶å€™ç»å¸¸éœ€è¦æ ¹æ®åç«¯è¿”å›çš„jsonæ•°æ®ï¼Œç„¶åæ¥ç”Ÿæˆhtmlï¼Œå†æ¸²æŸ“é¡µé¢ã€‚**ï¼Œæ¨¡æ¿å¼•æ“å°±æ˜¯å†™ä¸€ä¸ªé¡µé¢æ¨¡æ¿ï¼Œå°†ä¸€äº›åŠ¨æ€çš„å€¼ä¹Ÿèƒ½é€šè¿‡è¡¨è¾¾å¼å¡«å……åˆ°æŒ‡å®šä½ç½®



> å¯¼å…¥ä¾èµ–

```xml
<dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
```



> æºç 

ThymeleafProperties.class

ç›¸å½“äº**è§†å›¾è§£æå™¨**ï¼Œä¸ºèµ„æºåŠ ä¸Šå‰ç¼€åç¼€

```java
@ConfigurationProperties(prefix = "spring.thymeleaf")
public class ThymeleafProperties {

	private static final Charset DEFAULT_ENCODING = StandardCharsets.UTF_8;

    //æŒ‡å®šçš„è·¯å¾„ä¸ºtemplatesï¼Œå‰ç¼€å³ä¸ºè·¯å¾„
	public static final String DEFAULT_PREFIX = "classpath:/templates/";

    //æ–‡ä»¶åç¼€ä¸ºhtml
	public static final String DEFAULT_SUFFIX = ".html";
```

### èµ„æºä½ç½® tempates

é€šè¿‡controllerè·³è½¬èµ„æºï¼Œéœ€è¦æŠŠèµ„æºæ”¾åˆ°**templatesç›®å½•ä¸‹**

è€Œä¸”**templatesçš„èµ„æºåªå…è®¸controllerè®¿é—®**

![1588435240222](SpringBoot.assets/1588435240222.png)



> controller.classï¼š

**è§†å›¾å**ï¼šclasspath:/templates/æ–‡ä»¶å.html

```java
//   templatesç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æºï¼Œåªæœ‰controlleræ‰èƒ½è®¿é—®
//   å› ä¸ºæ²¡æœ‰è§†å›¾è§£æå™¨ï¼Œæ‰€ä»¥éœ€è¦æ¨¡æ¿å¼•æ“çš„æ”¯æŒ thymeleaf
@Controller
public class IndexController {

    
//    è®¾ç½®é¦–é¡µ
    @RequestMapping("/index")
    public String index(){
        return "index";
    }
    
   @RequestMapping("/test")
    public String test(Model model){
        model.addAttribute("message","YY");
        List<Object> lists = new ArrayList();
        lists.add("YZY");
        lists.add("YY");
//        æ¨¡æ¿å¼•æ“å°†è§†å›¾åæ‹¼æ¥æˆclasspath:/templates/test.html
        return "test";
    }
}
```

> test.html

```
<h1>test</h1>
<!--ç›´æ¥è¾“å‡ºå¯èƒ½ä¸ä¼šæ˜¾ç¤º-->
${message}
```

![1588435754010](SpringBoot.assets/1588435754010.png)

æ”¹è‰¯ç‰ˆ

```
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<!--ä½¿ç”¨thymeleafè¯­æ³•ï¼Œç±»ä¼¼vue
            th:å±æ€§-->
<p th:text="${message}"></p>
```

![1588436048058](SpringBoot.assets/1588436048058.png)

### è¯­æ³•

![1588476515969](SpringBoot.assets/1588476515969.png)

```html
<!--éå†é›†åˆ-->
<h2 th:each="list:${lists}" th:text="${list}"></h2>
<!--ä¹Ÿå¯ä»¥å†™åœ¨å†…å®¹ä¸­-->
<h2 th:each="list:${lists}" >[[ ${list} ]]</h2>
```

>  è·å–é™æ€èµ„æºéœ€è¦@{è·¯å¾„}

```js
th:href = "@{/css/**}"
```

> å¤ç”¨ä»£ç :

å¤ç”¨ç»„ä»¶æ”¾åœ¨ä¸€ä¸ªå…¬ç”¨æ–‡ä»¶å†…ï¼Œå¹¶ç”¨thï¼šfragmentæ ‡è®°

```html
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0" th:fragment="navBar">

```

è°ƒç”¨commonæ–‡ä»¶å¤¹çš„commonæ–‡ä»¶ä¸­çš„sideBarç»„ä»¶

```html
th:insert = '@{common/common::sideBar}'
```

> åˆ¤æ–­

```html
	<td th:text="${employee.getGender()==0?'å¥³':'ç”·'}"></td>
```



## è®¾ç½®é¦–é¡µ

>  æºç webMVCConfiguration

WelcomePageHandlerMappingï¼šæ¬¢è¿ç•Œé¢ï¼ˆé¦–é¡µï¼‰æ˜ å°„

```java
public WelcomePageHandlerMapping welcomePageHandlerMapping(ApplicationContext applicationContext,
				FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider) {
			WelcomePageHandlerMapping welcomePageHandlerMapping = new WelcomePageHandlerMapping(
					new TemplateAvailabilityProviders(applicationContext), applicationContext, getWelcomePage(),
					this.mvcProperties.getStaticPathPattern());
			welcomePageHandlerMapping.setInterceptors(getInterceptors(mvcConversionService, mvcResourceUrlProvider));
			return welcomePageHandlerMapping;
		}


		private Optional<Resource> getWelcomePage() {
            // è·å–èµ„æºç›®å½•
			String[] locations = getResourceLocations(this.resourceProperties.getStaticLocations());
			return Arrays.stream(locations).map(this::getIndexHtml).filter(this::isReadable).findFirst();
		}

//     è·å–é™æ€èµ„æºç›®å½•ä¸‹çš„index.html
		private Resource getIndexHtml(String location) {
			return this.resourceLoader.getResource(location + "index.html");
		}
```

å¯ä»¥å§é¦–é¡µæ”¾åœ¨èµ„æºç›®å½•çš„ä¸‰ä¸ª**é™æ€èµ„æºæ–‡ä»¶å¤¹**å†…

![1588416985284](SpringBoot.assets/1588416985284.png)

**æ˜ å°„æˆåŠŸ**

![1588418234051](SpringBoot.assets/1588418234051.png)

## æ‰©å±•MVC

æ‰©å±•MVCåŠŸèƒ½å¯ä»¥ä¼ å»ºä¸€ä¸ªMVCé…ç½®ç±»ï¼Œå¯ä»¥**æ¥ç®¡**è‡ªåŠ¨é…ç½®ç±»é‡Œçš„**æŸäº›åŠŸèƒ½**ï¼Œä¸å¯å…¨é¢æ¥ç®¡@EnableWebMVC



> æºç 

```java
public View resolveViewName(String viewName, Locale locale) throws Exception {
		RequestAttributes attrs = RequestContextHolder.getRequestAttributes();
		Assert.state(attrs instanceof ServletRequestAttributes, "No current ServletRequestAttributes");
		List<MediaType> requestedMediaTypes = getMediaTypes(((ServletRequestAttributes) attrs).getRequest());
		if (requestedMediaTypes != null) {
            //   è·å–springbootä¸­çš„æ‰€æœ‰è§£æå™¨
			List<View> candidateViews = getCandidateViews(viewName, locale, requestedMediaTypes);
            //  é€‰æ‹©å‡ºæœ€å¥½çš„è§†å›¾è§£æå™¨
			View bestView = getBestView(candidateViews, requestedMediaTypes, attrs);
			if (bestView != null) {
				return bestView;
			}
		}
```



> è‡ªå·±å†™ä¸€ä¸ªè§†å›¾è§£æå™¨

```java
//å¦‚æœåŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼ŒwebMVCè‡ªåŠ¨é…ç½®ç±»å°±ä¼šå¤±æ•ˆ
@EnableWebMvc
public class webMVCConfig implements WebMvcConfigurer {

//    ä¼šæŠŠè‡ªå·±å†™çš„è§†å›¾è§£æå™¨ä¹Ÿè£…é…åˆ°ç¯å¢ƒçš„è§†å›¾è§£æå™¨é‡Œ
    @Bean
    public ViewResolver view(){
        return new MyViewResolver();
    }

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/springboot").setViewName("test");
    }
}
//å®šä¹‰ä¸€ä¸ªè‡ªå·±å†™çš„è§†å›¾è§£æå™¨
class MyViewResolver implements ViewResolver{
//
    @Override
    public View resolveViewName(String s, Locale locale) throws Exception {
        return null;
    }


}
```

> ä¸å¯ä»¥åŠ ä¸Š@EnableWebMVC

webMVCConfigurationæ–‡ä»¶é‡Œæœ‰è¿™æ ·ä¸€å¥è¯ï¼š

```java
//å½“ä¸å­˜åœ¨è¿™ä¸ªWebMvcConfigurationSupport.classæ—¶æ¡ä»¶æˆç«‹
@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)
```

å¦‚æœåŠ ä¸Šï¼Œç‚¹å…¥æ³¨è§£

```java
// ç‚¹å…¥é…ç½®ç±»
@Import(DelegatingWebMvcConfiguration.class)
public @interface EnableWebMvc {
}

```

ç‚¹å…¥é…ç½®ç±»ï¼Œå‘ç°è¿™ä¸ªç±»**ç»§æ‰¿WebMvcConfigurationSupport**

```java
public class DelegatingWebMvcConfiguration extends WebMvcConfigurationSupport {
```

è¿™å°±å’Œå‰é¢çš„è‡ªåŠ¨é…ç½®ç±»å†²çªï¼Œå¯¼è‡´è‡ªåŠ¨é…ç½®ç±»é…ç½®ç±»å¤±æ•ˆ



## ä¸šåŠ¡

æ¨¡æ‹Ÿæ•°æ®åº“

> è¡¨

```java
//éƒ¨é—¨è¡¨
public class Department {

    private Integer id;
    private String departmentName;
```

```java
//å‘˜å·¥è¡¨
public class Employee {

    private Integer id;
    private String lastName;
    private String email;
//    æ€§åˆ« å¥³ï¼š0 ç”·ï¼š1
    private Integer gender;
    private Department department;
    private Date birth;
```

> ä¸šåŠ¡å±‚

```java
@Repository
public class DepartmentDao {

//    æ¨¡æ‹Ÿæ•°æ®
    private static Map<Integer, Department> departmentMap = null;
    static{
        departmentMap = new HashMap<>();
        departmentMap.put(1,new Department(101,"å¼€å‘"));
        departmentMap.put(2,new Department(102,"è¿ç»´"));
        departmentMap.put(3,new Department(103,"æµ‹è¯•"));
    }

//    ä¸šåŠ¡
//    è·å–æ‰€æœ‰éƒ¨é—¨ä¿¡æ¯
    public Collection<Department> findAllDepartment(){
        return departmentMap.values();
    }

//    é€šè¿‡idè·å–éƒ¨é—¨ä¿¡æ¯
    public Department findDepartMentByID(Integer id){
        return departmentMap.get(id);
    }

}
```

```java
@Repository
public class EmployeeDap {

    private static Map<Integer , Employee> employeeMap= null;
//    å‘˜å·¥æ‰€å±çš„éƒ¨é—¨
    @Autowired
    private DepartmentDao departmentDao;

    static{
        employeeMap = new HashMap<>();
        employeeMap.put(1,new Employee(1,"YZY","email1",1,new Department(1,"å¼€å‘")));
        employeeMap.put(2,new Employee(2,"YY","email2",0,new Department(2,"è¿ç»´")));
        employeeMap.put(3,new Employee(3,"JJ","email3",0,new Department(1,"å¼€å‘")));
        employeeMap.put(4,new Employee(4,"HC","email4",1,new Department(3,"æµ‹è¯•")));
    }

//    ä¸šåŠ¡\
//    ä¸»é”®è‡ªå¢
    private static Integer initid = 5;
//    å¢åŠ ä¸€ä¸ªå‘˜å·¥
    public void addEmployee(Employee employee){
        employeeMap.put(initid++,employee);
    }
//    åˆ é™¤ä¸€ä¸ªå‘˜å·¥
    public void deleteEmployee(Integer id){
        employeeMap.remove(id);
    }
//    ä¿®æ”¹å‘˜å·¥
    public void updateEmployee(Employee employee){
        employeeMap.replace(employee.getId(),employee);
    }
//    æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥
    public Collection<Employee> findAllEmloyee(){
       return employeeMap.values();
    }
//    é€šè¿‡idæŸ¥æ‰¾å‘˜å·¥
    public Employee findEmloyeeById(Integer id){
        return employeeMap.get(id);
    }

}
```



å¦‚æœç›´æ¥æŠŠä¸»é¡µè·³è½¬æ”¾åœ¨controllerå±‚ï¼Œ**é¡µé¢çš„æ ·å¼ä¸ä¼šåŠ è½½**





## å›½é™…åŒ–

ç™»å½•ç•Œé¢å¯ä»¥åˆ‡æ¢ä¸­æ–‡å’Œè‹±æ–‡

![1588513543101](SpringBoot.assets/1588513543101.png)



æƒ³è¦åˆ‡æ¢ï¼Œå°±éœ€è¦ä¸€ä¸ªé…ç½®ç±»ï¼š

> MyLocaleResolveré…ç½®ç±»

```java
@Configuration
public class MyLocaleResolver implements LocaleResolver {

    @Override
    public Locale resolveLocale(HttpServletRequest request) {
//        è·å¾—è¯­è¨€åˆ‡æ¢çš„å‚æ•°è¯·æ±‚
        String language = request.getParameter("language");
//        é»˜è®¤
        Locale locale = Locale.getDefault();
//        å¦‚æœæºå¸¦äº†å‚æ•°ï¼Œå°±èµ‹å€¼è¿”å›
        if(!StringUtils.isEmpty(language))
        {
//            _åˆ†å‰²ï¼šè¯­è¨€ï¼Œå›½å®¶
            String[] split = language.split("_");
            locale = new Locale(split[0],split[1]);
        }
        return locale;
    }

    @Override
    public void setLocale(HttpServletRequest request, HttpServletResponse response, Locale locale) {

    }
}
```

> MyWebMVCConfig

```java
@Configuration
public class MyMVCConfig implements WebMvcConfigurer {
    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/").setViewName("index");
        registry.addViewController("/index.html").setViewName("index");
    }

//    è‡ªå®šä¹‰çš„å›½é™…åŒ–ç»„ä»¶ç”Ÿæ•ˆ
    @Bean
    public LocaleResolver localeResolver(){
        return new MyLocaleResolver();
    }
}
```



## æ‹¦æˆªå™¨

> åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨çš„ç±»

```java
public class LoginInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        String loginname = (String) request.getSession().getAttribute("loginname");
        if (loginname.length() != 0) {
            request.setAttribute("message","è¿˜æœªç™»é™†ï¼Œæ— æ³•è®¿é—®");
            request.getRequestDispatcher("/index.html").forward(request,response);
            return true;
        } else {
            return false;
        }
    }
}
```

> åœ¨webMVCConfigurationé…ç½®æ‹¦æˆªå™¨

```java
//æ·»åŠ è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
//                                                          æ‹¦æˆªå…¨éƒ¨è¯·æ±‚ï¼Œé™¤äº†ä¸»é¡µå’Œç™»å½•è¯·æ±‚,è¿˜æœ‰é™æ€èµ„æº
        registry.addInterceptor(new LoginInterceptor()).addPathPatterns("/**")
                .excludePathPatterns("/index.html","/","/login","/css/**","/img/**","/js/**");
    }
```



## é¡µé¢

### æå–å…¬å…±å…ƒç´ 

æå–åˆ°ä¸€ä¸ªå…¬å…±æ–‡ä»¶**common/common.html**

```html
<!--å¤´éƒ¨å¯¼èˆªæ -->
<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0" th:fragment="navBar">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="http://getbootstrap.com/docs/4.0/examples/dashboard/#">æ¬¢è¿ç”¨æˆ·ï¼š[[${session.loginname}]]</a>
    <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
    <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
            <a class="nav-link" href="http://getbootstrap.com/docs/4.0/examples/dashboard/#">æ³¨é”€</a>
        </li>
    </ul>
</nav>


<!--ä¾§è¾¹å¯¼èˆªæ -->
<nav class="col-md-2 d-none d-md-block bg-light sidebar" th:fragment="sideBar">
    
    
    <!--å…¬å…±å…ƒç´ ä¸­æ¥æ”¶å‚æ•°å¹¶åˆ¤æ–­-->
    					<a th:class="${active=='list.html'?'nav-link active':'nav-link'}"></a>

```

å…¶ä»–é¡µé¢**è°ƒç”¨**ï¼ˆå¯å¸¦å‚æ•°ï¼‰

```html
<!--	å¤´éƒ¨å¯¼èˆªæ -->
<div th:replace="~{common/common::navBar}"></div>
<!--				ä¾§è¾¹æ ,å¸¦å‚æ•°-->
			<div th:replace="~{common/common::sideBar(active='main.html')}"></div>
```



### å‰ç«¯æµç¨‹

- åˆ›å»ºéœ€è¦çš„ç½‘é¡µ
- è°ƒç”¨å…¬å…±å…ƒç´ å’Œç¼–å†™å…¶ä»–å…ƒç´ 
- å°†ç½‘é¡µæ”¾å…¥webMVCConfigå†…ç®¡ç†
- ä¸ä¸šåŠ¡è¿æ¥